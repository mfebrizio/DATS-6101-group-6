---
title: "Technical Analysis"
author: "Team 6"
#date: "3/23/2022"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

```{r init, include=F}

# Import libraries
library(ezids)
library(dplyr)
library(data.table)
#library(readr)
library(lattice)
library(corrplot)

```


```{r setup, include=FALSE}

# knitr::opts_chunk$set(warning = F, results = "markup", message = F)
knitr::opts_chunk$set(warning = F, results = "hide", message = F, echo = TRUE)
options(scientific=T, digits = 3) 
# options(scipen=9, digits = 3) 
# ‘scipen’: integer. A penalty to be applied when deciding to print numeric values in fixed or exponential notation.  Positive values bias towards fixed and negative towards scientific notation: fixed notation will be preferred unless it is more than ‘scipen’ digits wider.
# use scipen=999 to prevent scientific notation at all times

```


# Technical Analysis

## Instructions

Technical analysis (R code), 25% (First attempt due: Mar 28 Monday 12:30pm)

Just before your team presentation, provide an R-markdown, or R script file, which shows the R-code and brief explanations as well as the rationale of the Exploratory Data Analysis of
your project. (Also submit your data file, or give the online source url.) This submission,
together with your final document (in part VI), will determine your team’s grade. This
document shows a technical person the math/stat/codes that you used in your analysis. It
should include:  
- Summary of the dataset
- Descriptive Statistics
- Graphical representations of the data
- [When applicable] Measures of Variance / sd
- [When applicable] Normality tests
- [When applicable] Initial correlation / Chi Square tests / ANOVA analysis / Z-test or Z-interval / T-test or T-interval etc.


## Summary

**Assigned to:** Mark

```{r import, results='hide', echo=F}

# import csv as dataframe
dframe <- data.frame(read.csv("data/processed/analytic_data_2016_2021.csv"))

# convert variables to type factor
dframe$statecode <- factor(dframe$statecode)
dframe$countycode <- factor(dframe$countycode)
dframe$fipscode <- factor(dframe$fipscode)
dframe$county_ranked <- factor(dframe$county_ranked)

# check structure of data
str(dframe)

```

```{r summary, results='hide'}

# look at county_ranked var; not all counties are ranked; also some aggregated data per state and country exist in the observations
# =1 means they are ranked, =0 means unranked, and =NA is for state/national data
print(summary(dframe$county_ranked))

# subset of dataframe including only ranked counties
ranked <- dframe %>% subset(county_ranked==1)

# subset of dataframe including only ranked counties
unranked <- dframe %>% subset(county_ranked==0)

# subset of dataframe including only aggregated data
aggregated <- dframe %>% subset(is.na(county_ranked))

# subset ranked data into annual datasets
ranked16 <- ranked %>% subset(year==2016)
ranked17 <- ranked %>% subset(year==2017)
ranked18 <- ranked %>% subset(year==2018)
ranked19 <- ranked %>% subset(year==2019)
ranked20 <- ranked %>% subset(year==2020)
ranked21 <- ranked %>% subset(year==2021)

# view size of annual datasets
df_annual_list <- list(ranked16, ranked17, ranked18, ranked19, ranked20, ranked21)
for (df in df_annual_list) {
  print(paste("Observations in", median(df$year), "data: ", nrow(df)))
  
}

```

Our data are identified at the county-year level. Our data set contains `r nrow(dframe)` observations and `r ncol(dframe)` variables, although `r nrow(aggregated)` of these observations are for aggregated data at the national or state level. In addition, `r nrow(unranked)` observations are for counties that are unranked by the [University of Wisconsin Population Health Institute](https://www.countyhealthrankings.org/explore-health-rankings/faq-page), suggesting that the data for these counties is less reliable.

In total, we have `r nrow(ranked)` observations in the ranked data, combined across 6 annual reports (2016–2021). Each annual data set has between 3071 and 3084 observations, indicating that the number of ranked counties is consistent over time.

```{r ranked, results='markup'}

# view head and tail of ranked data
xkabledplyhead(ranked, 5, title = "Table: First 5 Rows of Ranked Data")
xkabledplytail(ranked, 5, title = "Table: Last 5 Rows of Ranked Data")

```


## Descriptive Statistics

**Assigned to:** Alex

```{r dstats, results='markup'}

summary()
xkablesummary()


```


## Graphs and Figures

**Assigned to:** Mark (with help from Shumel & Xuan)

For example, histograms, boxplots, scatterplots, line graphs (for aggregated annual data), etc. We should use the `ggplot()` function.

```{r graphs_init, results='hide'}

loadPkg("ggplot2")

```


```{r histograms, results='markup'}

# Shumel -- please work on some histograms


```


```{r boxplots, results='markup'}

# Xuan -- please work on some boxplots


```




## Measures of Variation
*When applicable.*

**Assigned to:** Xuan

Variance, standard deviation, etc.

```{r variance, results='markup'}


```


## Normality tests
*When applicable.*

**Assigned to:** Shumel

For example, histograms, Q-Q plots, etc. Try `ezids::outlierKD2()` function if necessary.

```{r norm, results='markup'}

qqnorm()
qqline()

```



## Initial Correlation and Hypothesis Tests
*When applicable.*

**Assigned to:** Alex (with help from Mark)

For example, Chi Square tests, ANOVA analysis, Z-test or Z-interval, T-test or T-interval, etc.

```{r corr, results='markup'}

t.test()

table() ## creates contingency table
chisq.test()

aov(y ~ x, data=)


pairs()
cor() ## correlation matrix
corrplot()


```



## Linear Modeling and Regression
*When applicable. Might not need at all.*

**Assigned to:** TBD

```{r reg, results='markup'}

lm()
xkablevif()
anova()
xkabledply()


```

