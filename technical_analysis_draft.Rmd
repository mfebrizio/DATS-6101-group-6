---
title: "Technical Analysis"
author: "Team 6"
#date: "3/23/2022"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

```{r init, include=F}

# Import libraries
library(ezids)
library(dplyr)
library(data.table)
#library(readr)
library(lattice)
library(corrplot)

```


```{r setup, include=FALSE}

# knitr::opts_chunk$set(warning = F, results = "markup", message = F)
knitr::opts_chunk$set(warning = F, results = "hide", message = F, echo = TRUE)
options(scientific=T, digits = 3) 
# options(scipen=9, digits = 3) 
# ‘scipen’: integer. A penalty to be applied when deciding to print numeric values in fixed or exponential notation.  Positive values bias towards fixed and negative towards scientific notation: fixed notation will be preferred unless it is more than ‘scipen’ digits wider.
# use scipen=999 to prevent scientific notation at all times


```


# Technical Analysis

## Instructions

Technical analysis (R code), 25% (First attempt due: Mar 28 Monday 12:30pm)

Just before your team presentation, provide an R-markdown, or R script file, which shows the R-code and brief explanations as well as the rationale of the Exploratory Data Analysis of
your project. (Also submit your data file, or give the online source url.) This submission,
together with your final document (in part VI), will determine your team’s grade. This
document shows a technical person the math/stat/codes that you used in your analysis. It
should include:  
- Summary of the dataset
- Descriptive Statistics
- Graphical representations of the data
- [When applicable] Measures of Variance / sd
- [When applicable] Normality tests
- [When applicable] Initial correlation / Chi Square tests / ANOVA analysis / Z-test or Z-interval / T-test or T-interval etc.

## Summary

**Assigned to:** Mark

The variables in the dataset are:

* `region`: name of the US Census Bureau region (name)
* `division`: name of the US Census Bureau division (contained with a census region)
* `state`: state abbreviation
* `statecode`: FIPS state code
* `countycode`: FIPS county code
* `fipscode`: 5-digit FIPS Code (county-level); combines `statecode` and `countycode`
* `county`: county name
* `year`: report release year from [County Health Rankings](https://www.countyhealthrankings.org/); range of 2016-2021
* `county_ranked`: Indicates whether or not the county was ranked; 0=unranked, 1=ranked, or NA for aggregated national or state-level data
* `mental_health_days`: Average number of mentally unhealthy days reported in past 30 days (age-adjusted)
* `mental_distress_rate`: Percentage of adults reporting 14 or more days of poor mental health per month
* `inequality`: Ratio of household income at the 80th percentile to income at the 20th percentile (Income inequality)
* `median_inc`: The income where half of households in a county earn more and half of households earn less
* `hs_grad`: Percentage of adults ages 25 and over with a high school diploma or equivalent
* `college`: Percentage of adults ages 25-44 with some post-secondary education
* `unempl`: Percentage of population ages 16 and older unemployed but seeking work
* `child_poverty`: Percentage of people under age 18 in poverty
* `single_parent`: Percentage of children that live in a household headed by single parent
* `severe_housing`: Percentage of households with severe housing problems
* `food_index`: Index of factors that contribute to a healthy food environment, from 0 (worst) to 10 (best)
* `mh_providers`: rate of providers to 100,000 population
* `pop_provider_ratio`: ratio of population to mental health providers (i.e., population served per provider)
* `pop`: census population estimate
* `pct_below18`: percent of population younger than 18
* `pct_black`: percent of population that are African-American or non-Hispanic Black
* `pct_native_am`: percent of population that are Native American or Alaska Natives
* `pct_asian`: percent of population that are Asian
* `pct_pacific`: percent of population that are Native Hawaiian or Other Pacific Islander
* `pct_hispanic`: percent of population that are Hispanic
* `pct_white`: percent of population that are non-Hispanic white or Caucasian
* `pct_female`: percent of population that are female
* `pct_rural`: percent of population that live in rural areas

For more information, see [the measures online](https://www.countyhealthrankings.org/explore-health-rankings/measures-data-sources/2021-measures).


```{r import, results='hide', echo=F}

# import csv as dataframe
dframe <- data.frame(read.csv("data/processed/analytic_data_2016_2021_with_regions.csv"))

# convert variables to factor
dframe$region <- factor(dframe$region)
dframe$division <- factor(dframe$division)
dframe$statecode <- factor(dframe$statecode)
dframe$countycode <- factor(dframe$countycode)
dframe$fipscode <- factor(dframe$fipscode)
dframe$county_ranked <- factor(dframe$county_ranked)

# check structure of data
str(dframe)
summary(dframe)

```

```{r summary, results='hide'}

# look at county_ranked var; not all counties are ranked; also some aggregated data per state and country exist in the observations
# =1 means they are ranked, =0 means unranked, and =NA is for state/national data
print(summary(dframe$county_ranked))

# subset of dataframe including only ranked counties
ranked <- dframe %>% subset(county_ranked==1)

# subset of dataframe including only ranked counties
unranked <- dframe %>% subset(county_ranked==0)

# subset of dataframe including only aggregated data
aggregated <- dframe %>% subset(is.na(county_ranked))

# subset ranked data into annual datasets
ranked16 <- ranked %>% subset(year==2016)
ranked17 <- ranked %>% subset(year==2017)
ranked18 <- ranked %>% subset(year==2018)
ranked19 <- ranked %>% subset(year==2019)
ranked20 <- ranked %>% subset(year==2020)
ranked21 <- ranked %>% subset(year==2021)

# view size of annual datasets
df_annual_list <- list(ranked16, ranked17, ranked18, ranked19, ranked20, ranked21)
for (df in df_annual_list) {
  print(paste("Observations in", median(df$year), "data: ", nrow(df)))
  
}

```

Our data are identified at the county-year level. Our data set contains `r nrow(dframe)` observations and `r ncol(dframe)` variables, although `r nrow(aggregated)` of these observations are for aggregated data at the national or state level. In addition, `r nrow(unranked)` observations are for counties that are unranked by the [University of Wisconsin Population Health Institute](https://www.countyhealthrankings.org/explore-health-rankings/faq-page), suggesting that the data for these counties is less reliable.

In total, we have `r nrow(ranked)` observations in the ranked data, combined across 6 annual reports (2016–2021). Each annual data set has between 3071 and 3084 observations, indicating that the number of ranked counties is consistent over time.

```{r ranked, results='markup'}

# view head and tail of ranked data
xkabledplyhead(ranked, 5, title = "Table: First 5 Rows of Ranked Data")
xkabledplytail(ranked, 5, title = "Table: Last 5 Rows of Ranked Data")

# groupby year
ranked_by_year <- ranked %>% group_by(year)

summ_by_year <- ranked_by_year %>%  summarize(num_counties = n_distinct(fipscode), 
                              num_states = n_distinct(statecode),
                              wmean_inequality = weighted.mean(inequality, pop, na.rm=T), 
                              wmean_mh_rate = weighted.mean(mental_distress_rate, pop, na.rm=T), 
                              wmean_mh_days = weighted.mean(mental_health_days, pop, na.rm=T), 
                              wmean_unempl = weighted.mean(unempl, pop, na.rm=T), 
                              wmean_medinc = weighted.mean(median_inc, pop, na.rm=T),
                              )

summ_by_year

# groupby year and state
ranked_by_year_state <- ranked %>% group_by(year, statecode)

summ_by_year_state <- ranked_by_year_state %>% summarize(num_obs = n(), 
                                   state_name = first(state),
                                   region = first(region),
                                   wmean_inequality = weighted.mean(inequality, 
                                                                    pop, na.rm = T),
                                   med_inequality = median(inequality, na.rm = T),
                                   wmean_mh_rate = weighted.mean(mental_distress_rate, 
                                                                 pop, na.rm=T),
                                   med_mh_rate = median(mental_distress_rate, na.rm=T),
                                   wmean_mh_days = weighted.mean(mental_health_days, 
                                                                 pop, na.rm=T), 
                                   med_mh_days = median(mental_health_days, na.rm=T),
                                   wmean_unempl = weighted.mean(unempl, 
                                                                pop, na.rm=T), 
                                   med_unempl = median(unempl, na.rm=T),
                                   wmean_medinc = weighted.mean(median_inc, 
                                                                pop, na.rm=T),
                                   med_medinc = median(median_inc, na.rm=T)
                                   )

summ_by_year_state

# groupby region
ranked_by_region <- ranked %>% group_by(region)

summ_by_region <- ranked_by_region %>%  summarize(num_counties = n_distinct(fipscode), 
                              num_states = n_distinct(statecode),
                              wmean_inequality = weighted.mean(inequality, pop, na.rm=T), 
                              wmean_mh_rate = weighted.mean(mental_distress_rate, pop, na.rm=T), 
                              wmean_mh_days = weighted.mean(mental_health_days, pop, na.rm=T), 
                              wmean_unempl = weighted.mean(unempl, pop, na.rm=T), 
                              wmean_medinc = weighted.mean(median_inc, pop, na.rm=T),
                              )

summ_by_region


# groupby year and state
ranked_by_year_region <- ranked %>% group_by(year, region)

summ_by_year_region <- ranked_by_year_region %>% summarize(num_obs = n(), 
                                   region_name = first(region),
                                   sum_pop_millions = sum(pop/1000000, na.rm = T),
                                   wmean_inequality = weighted.mean(inequality, pop, na.rm = T),
                                   wmean_mh_rate = weighted.mean(mental_distress_rate, pop, na.rm=T),
                                   wmean_mh_days = weighted.mean(mental_health_days, pop, na.rm=T)
                                   )

summ_by_year_region


```


## Descriptive Statistics

**Assigned to:** Alex

```{r dstats, results='markup'}

summary()
xkablesummary()


```


## Graphs and Figures

**Assigned to:** Mark (with help from Shumel & Xuan)

For example, histograms, boxplots, scatterplots, line graphs (for aggregated annual data), etc. We should use the `ggplot()` function.

```{r graphs_init, results='hide'}

loadPkg("ggplot2")
loadPkg("patchwork") ## for combining graphs
loadPkg("purrr")
loadPkg("tidyr")
loadPkg("gridExtra")

```

```{r lines_annual, results='markup'}

# use summ_by_year

# annual trends for mental health var
p1 <- ggplot(summ_by_year, aes(x=year)) +
  geom_line(aes(y = wmean_mh_days), lwd=1) + 
  expand_limits(y=c(0,5)) +
  labs(title = "Poor Mental Health Days", 
       x = "Report Year", y = "Avg for past 30 days") +
  theme_minimal()

p2 <- ggplot(summ_by_year, aes(x=year)) +
  geom_line(aes(y = wmean_mh_rate), lwd=1) + 
  expand_limits(y=c(0,.2)) +
  labs(title = "Frequent Mental Distress Rate", 
       x = "Report Year", y = "Percentage of adults") + 
  theme_minimal()

# combine plots using patchwork package
p1 + p2

# annual trends for inequality and median income
p3 <- ggplot(summ_by_year, aes(x=year)) +
  geom_line(aes(y = wmean_inequality), lwd=1) + 
  expand_limits(y=c(0,5)) +
  labs(title = "Income Inequality", 
       x = "Report Year", y = "Ratio 80th : 20th pctl") +
  theme_minimal()

p4 <- ggplot(summ_by_year, aes(x=year)) +
  geom_line(aes(y = wmean_medinc / 1000), lwd=1) + 
  expand_limits(y=c(0,max(summ_by_year$wmean_medinc/1000)+5)) +
  labs(title = "Median Income", 
       x = "Report Year", y = "Thousands of Dollars") +
  theme_minimal()

p5 <- ggplot(summ_by_year, aes(x=year)) +
  geom_line(aes(y = wmean_unempl), lwd=1) + 
  expand_limits(y=c(0,.10)) +
  labs(title = "Unemployment Rate", 
       x = "Report Year", y = "Percent unemployed") +
  theme_minimal()

# combine plots
p3 / (p4 + p5)

```

```{r scatter_a, results='markup'}

# data: use ranked
# colnames(ranked)

#-- Dependent vs Explanatory --#

# color = median income
ggplot(ranked, aes(y=mental_health_days, x=inequality, color=median_inc/1000)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE, color="#a89968") +  ## Add linear regression line
  labs(title = "Scatterplot of Poor Mental Health Days vs. Inequality",
       y = 'Poor mental health days per 30', x = 'Income inequality rate', 
       color = "Median Income ($ Thous.)")

ggplot(ranked, aes(y=mental_distress_rate, x=inequality, color=median_inc/1000)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE, color="#a89968") + 
  labs(title = "Scatterplot of Frequent Distress vs. Inequality",
       y = 'Mental distress rate', x = 'Income inequality rate', 
       color = "Median Income ($ Thous.)")

# color = % rural
ggplot(ranked, aes(y=mental_health_days, x=inequality, color=pct_rural)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE, color="#a89968") +  ## Add linear regression line
  labs(title = "Scatterplot of Poor Mental Health Days vs. Inequality",
       y = 'Poor mental health days per 30', x = 'Income inequality rate', 
       color = "% Rural Pop.")

ggplot(ranked, aes(y=mental_distress_rate, x=inequality, color=pct_rural)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE, color="#a89968") + 
  labs(title = "Scatterplot of Frequent Distress vs. Inequality",
       y = 'Mental distress rate', x = 'Income inequality rate', 
       color = "% Rural Pop.")


#-- Dependent vs. Provision of Mental Health Care --#

# color = % rural
ggplot(ranked, aes(y=mental_health_days, x=pop_provider_ratio, color=pct_rural)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE, color="#a89968") + 
  labs(title = "Scatterplot of Poor Mental Health Days vs. Mental Health Providers",
       y = 'Mental distress rate', x = 'Ratio population : providers', 
       color = "% Rural Pop.")

ggplot(ranked, aes(y=mental_distress_rate, x=pop_provider_ratio, color=pct_rural)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE, color="#a89968") + 
  labs(title = "Scatterplot of Frequent Distress vs. Mental Health Providers",
       y = 'Mental distress rate', x = 'Ratio population : providers', 
       color = "% Rural Pop.")

```

```{r scatter_b, results='markup'}

# Multi-plot figures

#-- Inequality vs. other economic variables --#

# unempl, child_poverty, hs_grad, college, single_parent, severe_housing, food_index

gg1 <- ggplot(ranked, aes(y=inequality, x=unempl)) + 
  geom_point() + 
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (a)")

gg2 <- ggplot(ranked, aes(y=inequality, x=severe_housing)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (b)")

gg3 <- ggplot(ranked, aes(y=inequality, x=child_poverty)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (c)")

gg4 <- ggplot(ranked, aes(y=inequality, x=single_parent)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (d)")

gg5 <- ggplot(ranked, aes(y=inequality, x=hs_grad)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (e)")

gg6 <- ggplot(ranked, aes(y=inequality, x=college)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (f)")

gg7 <- ggplot(ranked, aes(y=inequality, x=food_index)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (g)")

plot_list <- list(gg1, gg2, gg3, gg4, gg5, gg6, gg7)

do.call("grid.arrange", c(plot_list, ncol = 3))


#-- Dependent vs. other economic variables --#

# poor mental health days
gg1 <- ggplot(ranked, aes(y=mental_health_days, x=unempl)) + 
  geom_point() + 
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (a)")

gg2 <- ggplot(ranked, aes(y=mental_health_days, x=severe_housing)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (b)")

gg3 <- ggplot(ranked, aes(y=mental_health_days, x=child_poverty)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (c)")

gg4 <- ggplot(ranked, aes(y=mental_health_days, x=single_parent)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (d)")

gg5 <- ggplot(ranked, aes(y=mental_health_days, x=hs_grad)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (e)")

gg6 <- ggplot(ranked, aes(y=mental_health_days, x=college)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (f)")

gg7 <- ggplot(ranked, aes(y=mental_health_days, x=food_index)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (g)")

plot_list <- list(gg1, gg2, gg3, gg4, gg5, gg6, gg7)

do.call("grid.arrange", c(plot_list, ncol = 3))


# mental distress rate
gg1 <- ggplot(ranked, aes(y=mental_distress_rate, x=unempl)) + 
  geom_point() + 
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (a)")

gg2 <- ggplot(ranked, aes(y=mental_distress_rate, x=severe_housing)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (b)")

gg3 <- ggplot(ranked, aes(y=mental_distress_rate, x=child_poverty)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (c)")

gg4 <- ggplot(ranked, aes(y=mental_distress_rate, x=single_parent)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (d)")

gg5 <- ggplot(ranked, aes(y=mental_distress_rate, x=hs_grad)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (e)")

gg6 <- ggplot(ranked, aes(y=mental_distress_rate, x=college)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (f)")

gg7 <- ggplot(ranked, aes(y=mental_distress_rate, x=food_index)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (g)")

plot_list <- list(gg1, gg2, gg3, gg4, gg5, gg6, gg7)

do.call("grid.arrange", c(plot_list, ncol = 3))


```

```{r scatter_c, results='markup'}

# data: use ranked

#-- All Years --#

p1 <- ggplot(ranked, aes(y=mental_health_days, x=inequality, color = factor(region))) + 
  geom_point(show.legend = F) +
  labs(title = paste("(a) per 30 days"),
       y = 'Poor mental health days per 30', x = 'Income inequality rate', 
       color = "Region")

p2 <- ggplot(ranked, aes(y=mental_distress_rate, x=inequality, color = factor(region))) + 
  geom_point() + 
  labs(title = paste("(b) percentage"),
       y = 'Frequent distress rate', x = 'Income inequality rate', 
       color = "Region")

p_all <- p1 + p2 + plot_annotation(title = "Scatterplot of Mental health variables vs. Income inequality, 2016-2021")
p_all


#-- Is relationship sensitive to report year? --#

# 2016 vs 2021

# 2016
p1 <- ggplot(ranked16, aes(y=mental_health_days, x=inequality, color = factor(region))) + 
  geom_point(show.legend = F) +
  labs(title = "(a) per 30 days",
       y = 'Poor mental health days per 30', x = 'Income inequality rate', 
       color = "Region")

p2 <- ggplot(ranked16, aes(y=mental_distress_rate, x=inequality, color = factor(region))) + 
  geom_point() + 
  labs(title = "(b) percentage",
       y = 'Frequent distress rate', x = 'Income inequality rate', 
       color = "Region")

p16 <- p1 + p2 + plot_annotation(title = "Scatterplot of Mental health variables vs. Income inequality, 2016")
p16

# 2021
p1 <- ggplot(ranked21, aes(y=mental_health_days, x=inequality, color = factor(region))) + 
  geom_point(show.legend = F) +
  labs(title = "(a) per 30 days",
       y = 'Poor mental health days per 30', x = 'Income inequality rate', 
       color = "Region")

p2 <- ggplot(ranked21, aes(y=mental_distress_rate, x=inequality, color = factor(region))) + 
  geom_point() + 
  labs(title = "(b) percentage",
       y = 'Frequent distress rate', x = 'Income inequality rate', 
       color = "Region")

p21 <- p1 + p2 + plot_annotation(title = "Scatterplot of Mental health variables vs. Income inequality, 2021")
p21


# 2016 mental_health_days data looks weird (like it's been rounded)
# let's check 2017
p1 <- ggplot(ranked17, aes(y=mental_health_days, x=inequality, color = factor(region))) + 
  geom_point(show.legend = F) +
  labs(title = "(a) per 30 days",
       y = 'Poor mental health days per 30', x = 'Income inequality rate', 
       color = "Region")

p2 <- ggplot(ranked17, aes(y=mental_distress_rate, x=inequality, color = factor(region))) + 
  geom_point() + 
  labs(title = "(b) percentage",
       y = 'Frequent distress rate', x = 'Income inequality rate', 
       color = "Region")

p17 <- p1 + p2 + plot_annotation(title = "Scatterplot of Mental health variables vs. Income inequality, 2017")
p17


```

```{r scatter_agg, results='markup'}

# data: use summ_by_year_state
# aggregated to the state level

#-- Dependent vs Explanatory --#

# means by state
ggplot(summ_by_year_state, aes(y=wmean_mh_days, x=wmean_inequality, color=wmean_medinc/1000)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE, color="#a89968") + 
  labs(title = "Scatterplot of State-level Means (Population weighted)",
       y = 'Poor mental health days per 30', x = 'Income inequality rate', 
       color = "Mean Median Inc ($T)")

ggplot(summ_by_year_state, aes(y=wmean_mh_rate, x=wmean_inequality, color=wmean_medinc/1000)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE, color="#a89968") + 
  labs(title = "Scatterplot of State-level Means (Population weighted)",
       y = 'Mental distress rate', x = 'Income inequality rate', 
       color = "Mean Median Inc ($T)")

# medians by state
ggplot(summ_by_year_state, aes(y=med_mh_days, x=med_inequality, color=med_medinc/1000)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE, color="#a89968") +  ## Add linear regression line
  labs(title = "Scatterplot of State-level Medians",
       y = 'Poor mental health days per 30', x = 'Income inequality rate', 
       color = "Med. Median Inc ($T)")

ggplot(summ_by_year_state, aes(y=med_mh_rate, x=med_inequality, color=med_medinc/1000)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE, color="#a89968") + 
  labs(title = "Scatterplot of State-level Medians",
       y = 'Mental distress rate', x = 'Income inequality rate', 
       color = "Med. Median Inc ($T)")



#summ_by_year_state

```


```{r hist_multiple, results='markup'}

# https://www.r-bloggers.com/2016/07/quick-plot-of-all-variables/

keep_var <- c('inequality', 'unempl', 'child_poverty', 'hs_grad', 'college', 'single_parent', 'severe_housing', 'food_index', 'mental_health_days', 'mental_distress_rate', 'median_inc')

#ranked[keep_var]

ranked[keep_var] %>% 
  gather() %>% 
  ggplot(aes(x=value)) + 
    facet_wrap(~ key, scales = "free") + 
    geom_histogram(bins=50)


```


```{r histograms, results='markup'}

# Shumel -- please work on some histograms


```


```{r boxplots, results='markup'}

# Xuan -- please work on some boxplots
# In this part, in order to better show the relationship between the economic level and mental health of people, mental_distress_rate in different regions of the United States, I divided the United States into 4 regions by geographical method (for details, you can check this link below). I will analyze the four parts of "Northeast", "South", "West", "Midwest" separately.(https://www2.census.gov/geo/pdfs/maps-data/maps/reference/us_regdiv.pdf) In addition, I would like to say that there are many independent variables and dependent variables selected by our group, but in order to shorten the space and highlight the key points, I only select two independent variables and two dependent variable for analysis. The two independent variables that I selected are "Median household income" (median_inc) and "Food environment index" (food_index). The two dependent variable that I selected is "Poor mental health days" (mental_health_days) and "Frequent mental distress rate" (mental_distress_rate).
dframe0NA <- na.omit(dframe)
#1.1 Analysis of Northeast in 2016
#View(dframe)
dframe2016 = subset(dframe0NA, year == 2016)
dframe2016West = subset(dframe2016, region == "West")
#boxplot(dframe2016West$mental_health_days, main="The relationship between median_inc and mental_health_days", ylab="mental_health_days(days)",col='#0000FF')

loadPkg("ggplot2")
dframe$year <- factor(dframe$year)
# dframe$year <- factor(dframe$year)
# Characterization of the median annual income of households in four regions of the United States in 2016.
dframe2016 = subset(dframe0NA, year == 2016)
ggplot(dframe2016, aes(x=region, y=median_inc)) + 
  geom_boxplot() + 
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="The Characterization of median_inc of four regions in 2016")

# Characterization of the median annual income of households in four regions of the United States in 2017.
dframe2017 = subset(dframe0NA, year == 2017)
ggplot(dframe2017, aes(x=region, y=median_inc)) + 
  geom_boxplot() + 
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="The Characterization of median_inc of four regions in 2017")

# Characterization of the median annual income of households in four regions of the United States in 2018.
dframe2018 = subset(dframe0NA, year == 2018)
ggplot(dframe2018, aes(x=region, y=median_inc)) + 
  geom_boxplot() + 
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="The Characterization of median_inc of four regions in 2018")

# Characterization of the median annual income of households in four regions of the United States in 2019.
dframe2019 = subset(dframe0NA, year == 2019)
ggplot(dframe2019, aes(x=region, y=median_inc)) + 
  geom_boxplot() + 
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="The Characterization of median_inc of four regions in 2019")

# Characterization of the median annual income of households in four regions of the United States in 2020.
dframe2020 = subset(dframe0NA, year == 2020)
ggplot(dframe2020, aes(x=region, y=median_inc)) + 
  geom_boxplot() + 
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="The Characterization of median_inc of four regions in 2020")

# Characterization of the median annual income of households in four regions of the United States in 2021.
dframe2021 = subset(dframe0NA, year == 2021)
ggplot(dframe2021, aes(x=region, y=median_inc)) + 
  geom_boxplot() + 
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="The Characterization of median_inc of four regions in 2021")
```
```{r boxplots, results='markup'}
# Characterization of the Poor mental health days in four regions of the United States in 2016.
ggplot(dframe2016, aes(x=region, y=mental_health_days)) + 
  geom_boxplot() + 
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="The Characterization of mental unhealthy days/month of four regions in 2016")

# Characterization of the Poor mental health days in four regions of the United States in 2017.
ggplot(dframe2017, aes(x=region, y=mental_health_days)) + 
  geom_boxplot() + 
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="The Characterization of mental unhealthy days/month of four regions in 2017")

# Characterization of the Poor mental health days in four regions of the United States in 2018.
ggplot(dframe2018, aes(x=region, y=mental_health_days)) + 
  geom_boxplot() + 
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="The Characterization of mental unhealthy days/month of four regions in 2018")

# Characterization of the Poor mental health days in four regions of the United States in 2019.
ggplot(dframe2019, aes(x=region, y=mental_health_days)) + 
  geom_boxplot() + 
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="The Characterization of mental unhealthy days/month of four regions in 2019")

# Characterization of the Poor mental health days in four regions of the United States in 2020.
ggplot(dframe2020, aes(x=region, y=mental_health_days)) + 
  geom_boxplot() + 
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="The Characterization of mental unhealthy days/month of four regions in 2020")

# Characterization of the Poor mental health days in four regions of the United States in 2021.
ggplot(dframe2021, aes(x=region, y=mental_health_days)) + 
  geom_boxplot() + 
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="The Characterization of mental unhealthy days/month of four regions in 2021")
```

## Measures of Variation
*When applicable.*

**Assigned to:** Xuan

Variance, standard deviation, etc.

```{r variance, results='markup'}
#var(mental_health_days,na.rm=TRUE)
dframe$mental_health_days
var(dframe$mental_health_days,na.rm=TRUE)

```


## Normality tests
*When applicable.*

**Assigned to:** Shumel

For example, histograms, Q-Q plots, etc. Try `ezids::outlierKD2()` function if necessary.

```{r norm, results='markup'}

qqnorm()
qqline()

```



## Initial Correlation and Hypothesis Tests
*When applicable.*

**Assigned to:** Alex (with help from Mark)

For example, Chi Square tests, ANOVA analysis, Z-test or Z-interval, T-test or T-interval, etc.

```{r corr, results='markup'}

t.test()

table() ## creates contingency table
chisq.test()

aov(y ~ x, data=)


pairs()
cor() ## correlation matrix
corrplot()


```



## Linear Modeling and Regression
*When applicable. Might not need at all.*

**Assigned to:** TBD

```{r reg, results='markup'}

lm()
xkablevif()
anova()
xkabledply()


```

