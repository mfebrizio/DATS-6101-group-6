---
title: "Investigating the Relationship between Mental Health and Income Inequality"
author: "Team 6: Mark Febrizio, Shumel Siraj, Alex Thiersch, Xuan Zou"
#date: "3/23/2022"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
  runtime: shiny
---

```{r init, include=F}

# Import libraries
library(ezids)
library(dplyr)
library(data.table)
library(readr)
library(lattice)
library(corrplot)
library(psych)
library(kableExtra)
library(ggpubr)
library(Hmisc)

```


```{r setup, include=FALSE}

# knitr::opts_chunk$set(warning = F, results = "markup", message = F)
knitr::opts_chunk$set(warning = F, results = "hide", message = F, echo = TRUE)
options(scientific=T, digits = 3) 
# options(scipen=9, digits = 3) 
# ‘scipen’: integer. A penalty to be applied when deciding to print numeric values in fixed or exponential notation.  Positive values bias towards fixed and negative towards scientific notation: fixed notation will be preferred unless it is more than ‘scipen’ digits wider.
# use scipen=999 to prevent scientific notation at all times

```


# Technical Analysis

## Instructions

Technical analysis (R code), 25% (First attempt due: Mar 28 Monday 12:30pm)

Just before your team presentation, provide an R-markdown, or R script file, which shows the R-code and brief explanations as well as the rationale of the Exploratory Data Analysis of
your project. (Also submit your data file, or give the online source url.) This submission,
together with your final document (in part VI), will determine your team’s grade. This
document shows a technical person the math/stat/codes that you used in your analysis.

The document should include:

- Summary of the dataset
- Descriptive Statistics
- Graphical representations of the data
- [When applicable] Measures of Variance / sd
- [When applicable] Normality tests
- [When applicable] Initial correlation / Chi Square tests / ANOVA analysis / Z-test or Z-interval / T-test or T-interval etc.

## Summary

**Assigned to:** Mark

The variables in the dataset are:

* `region`: name of the US Census Bureau region (name)
* `division`: name of the US Census Bureau division (contained with a census region)
* `state`: state abbreviation
* `statecode`: FIPS state code
* `countycode`: FIPS county code
* `fipscode`: 5-digit FIPS Code (county-level); combines `statecode` and `countycode`
* `county`: county name
* `year`: report release year from [County Health Rankings](https://www.countyhealthrankings.org/); range of 2016-2021
* `county_ranked`: Indicates whether or not the county was ranked; 0=unranked, 1=ranked, or NA for aggregated national or state-level data
* `mental_health_days`: Average number of mentally unhealthy days reported in past 30 days (age-adjusted)
* `mental_distress_rate`: Percentage of adults reporting 14 or more days of poor mental health per month
* `inequality`: Ratio of household income at the 80th percentile to income at the 20th percentile (Income inequality)
* `median_inc`: The income where half of households in a county earn more and half of households earn less
* `hs_grad`: Percentage of adults ages 25 and over with a high school diploma or equivalent
* `college`: Percentage of adults ages 25-44 with some post-secondary education
* `unempl`: Percentage of population ages 16 and older unemployed but seeking work
* `child_poverty`: Percentage of people under age 18 in poverty
* `single_parent`: Percentage of children that live in a household headed by single parent
* `severe_housing`: Percentage of households with severe housing problems
* `food_index`: Index of factors that contribute to a healthy food environment, from 0 (worst) to 10 (best)
* `mh_providers`: rate of providers to 100,000 population
* `pop_provider_ratio`: ratio of population to mental health providers (i.e., population served per provider)
* `pop`: census population estimate
* `pct_below18`: percent of population younger than 18
* `pct_black`: percent of population that are African-American or non-Hispanic Black
* `pct_native_am`: percent of population that are Native American or Alaska Natives
* `pct_asian`: percent of population that are Asian
* `pct_pacific`: percent of population that are Native Hawaiian or Other Pacific Islander
* `pct_hispanic`: percent of population that are Hispanic
* `pct_white`: percent of population that are non-Hispanic white or Caucasian
* `pct_female`: percent of population that are female
* `pct_rural`: percent of population that live in rural areas

For more information, see [the measures online](https://www.countyhealthrankings.org/explore-health-rankings/measures-data-sources/2021-measures).


```{r import, results='hide', echo=F}

# import csv as dataframe
dframe1 <- data.frame(read.csv("data/processed/analytic_data_2016_2021.csv"))
#View(dframe1)

dframe <- data.frame(read.csv("data/processed/analytic_data_2016_2021_with_regions.csv"))
#View(dframe)

# convert variables to factor
dframe$region <- factor(dframe$region)
dframe$division <- factor(dframe$division)
dframe$statecode <- factor(dframe$statecode)
dframe$countycode <- factor(dframe$countycode)
dframe$fipscode <- factor(dframe$fipscode)
dframe$county_ranked <- factor(dframe$county_ranked)

# check structure of data
str(dframe)
#summary(dframe)

```

```{r summary, results='hide'}

# look at county_ranked var; not all counties are ranked; also some aggregated data per state and country exist in the observations
# =1 means they are ranked, =0 means unranked, and =NA is for state/national data
print(summary(dframe$county_ranked))

# subset of dataframe including only ranked counties
ranked <- dframe %>% subset(county_ranked==1)

# subset of dataframe including only ranked counties
unranked <- dframe %>% subset(county_ranked==0)

# subset of dataframe including only aggregated data
aggregated <- dframe %>% subset(is.na(county_ranked))

# subset ranked data by region
ranked_MW <- ranked %>% subset(region=="Midwest")
ranked_NE <- ranked %>% subset(region=="Northeast")
ranked_SO <- ranked %>% subset(region=="South")
ranked_WE <- ranked %>% subset(region=="West")

# subset ranked data into annual datasets
ranked16 <- ranked %>% subset(year==2016)
ranked17 <- ranked %>% subset(year==2017)
ranked18 <- ranked %>% subset(year==2018)
ranked19 <- ranked %>% subset(year==2019)
ranked20 <- ranked %>% subset(year==2020)
ranked21 <- ranked %>% subset(year==2021)

# view size of annual datasets
df_annual_list <- list(ranked16, ranked17, ranked18, ranked19, ranked20, ranked21)
for (df in df_annual_list) {
  print(paste("Observations in", median(df$year), "data: ", nrow(df)))
  
}

# sort dataframe
ranked <- ranked[order(ranked$year, ranked$region, ranked$division, ranked$statecode, ranked$countycode), ]

# view head and tail of ranked data
xkabledplyhead(ranked, 2, title = "Table: First 2 Rows of Ranked Data")
xkabledplytail(ranked, 2, title = "Table: Last 2 Rows of Ranked Data")

```

Our data are identified at the county-year level. Our data set contains `r nrow(dframe)` observations and `r ncol(dframe)` variables, although `r nrow(aggregated)` of these observations are for aggregated data at the national or state level. In addition, `r nrow(unranked)` observations are for counties that are unranked by the [University of Wisconsin Population Health Institute](https://www.countyhealthrankings.org/explore-health-rankings/faq-page), suggesting that the data for these counties is less reliable.

In total, we have `r nrow(ranked)` observations in the ranked data, combined across 6 annual reports (2016–2021). Each annual data set has between 3071 and 3084 observations, indicating that the number of ranked counties is consistent over time.

We also grouped the data on several dimensions using the `group_by()` and `summarise()` functions from the dplyr package. This helped us better investigate time and geographic patterns in our data.

First, we grouped the data set by report year and calculating the population-weighted means for several variables. In general, the mean income inequality has stayed relatively constant over time, while the mental health variables have risen slightly. Other economic variables, such as unemployment and median income, have moved in positive directions (unemployment has fallen, while median incomes have increased). 

Next, we grouped the data by year and state and calculated population-weighted means and state-level medians. There was a lot more variation among the data at this level, which will be helpful when plotting aggregated data later.

Finally, we grouped the data by region, giving us a sense of the size of the 4 census regions: the South contains the most states and counties and has the largest population, while the Northeast is the smallest on these measures. The Northeast has highest measured inequality, and the Midwest has the lowest. The mental health variables are highest (i.e., worst) in the South and lowest in the West. These general trends hold up when grouping by year and region. These differences suggest that comparing the relationship between the variables across regions would be worthwhile.

```{r ranked, results='markup'}

# groupby year
ranked_by_year <- ranked %>% group_by(year)

summ_by_year <- ranked_by_year %>%  summarise(num_counties = n_distinct(fipscode), 
                              num_states = n_distinct(statecode),
                              wmean_inequality = weighted.mean(inequality, pop, na.rm=T), 
                              wmean_mh_rate = weighted.mean(mental_distress_rate, pop, na.rm=T), 
                              wmean_mh_days = weighted.mean(mental_health_days, pop, na.rm=T), 
                              wmean_unempl = weighted.mean(unempl, pop, na.rm=T), 
                              wmean_medinc = weighted.mean(median_inc, pop, na.rm=T),
                              )

xkabledplyhead(summ_by_year, 6, title = "Table: Data grouped by Year")


# groupby year and state
ranked_by_year_state <- ranked %>% group_by(year, statecode)

summ_by_year_state <- ranked_by_year_state %>% summarise(num_obs = n(), 
                                   state_name = first(state),
                                   region = first(region),
                                   wmean_inequality = weighted.mean(inequality, 
                                                                    pop, na.rm = T),
                                   med_inequality = median(inequality, na.rm = T),
                                   wmean_mh_rate = weighted.mean(mental_distress_rate, 
                                                                 pop, na.rm=T),
                                   med_mh_rate = median(mental_distress_rate, na.rm=T),
                                   wmean_mh_days = weighted.mean(mental_health_days, 
                                                                 pop, na.rm=T), 
                                   med_mh_days = median(mental_health_days, na.rm=T),
                                   wmean_unempl = weighted.mean(unempl, 
                                                                pop, na.rm=T), 
                                   med_unempl = median(unempl, na.rm=T),
                                   wmean_medinc = weighted.mean(median_inc, 
                                                                pop, na.rm=T),
                                   med_medinc = median(median_inc, na.rm=T)
                                   )

xkabledplyhead(summ_by_year_state, 8, title = "Table: Data grouped by Year and State")


# groupby region
ranked_by_region <- ranked %>% group_by(region)

summ_by_region <- ranked_by_region %>%  summarise(num_counties = n_distinct(fipscode), 
                              num_states = n_distinct(statecode),
                              wmean_inequality = weighted.mean(inequality, pop, na.rm=T), 
                              wmean_mh_rate = weighted.mean(mental_distress_rate, pop, na.rm=T), 
                              wmean_mh_days = weighted.mean(mental_health_days, pop, na.rm=T), 
                              wmean_unempl = weighted.mean(unempl, pop, na.rm=T), 
                              wmean_medinc = weighted.mean(median_inc, pop, na.rm=T),
                              )

xkabledplyhead(summ_by_region, 4, title = "Table: Data grouped by Region")


# groupby year and region
ranked_by_year_region <- ranked %>% group_by(year, region)

summ_by_year_region <- ranked_by_year_region %>% summarise(num_obs = n(), 
                                   region_name = first(region),
                                   sum_pop_millions = sum(pop/1000000, na.rm = T),
                                   wmean_inequality = weighted.mean(inequality, pop, na.rm = T),
                                   wmean_mh_rate = weighted.mean(mental_distress_rate, pop, na.rm=T),
                                   wmean_mh_days = weighted.mean(mental_health_days, pop, na.rm=T)
                                   )

xkabledplyhead(summ_by_year_region, 8, title = "Table: Data grouped by Year and Region")

```


## Descriptive Statistics

**Assigned to:** Alex

```{r dstats, results='markup'}
#Summary Statistics of all Variables used in dframe dataset
table1<-describeBy(dframe)
table1 %>%
  kbl(caption="Table 1: Summary Statistics for Master Dataset",
       format= "html", col.names = c("Var Num.","Count","Mean","Std. Dev.","Median", "Trimmed Mean", "Mad", "Minimum", "Maximum","Range", "Skewness", "Kurtosis", "S.E."),
      align="r") %>%
   kable_minimal(full_width = F, html_font = "helvetica")
#Summary Statistics of relevant Variables used in analysis below in dfram dataset
ranked2<-subset(ranked, select = c("mental_health_days", "mental_distress_rate", "inequality", "median_inc", "hs_grad", "college", "unempl", "child_poverty","single_parent", "severe_housing", "food_index","mh_providers","pop_provider_ratio"))
table2<-describeBy(ranked2)
table2 %>%
  kbl(caption="Descriptive Statistics of Dataset",
       format= "html", col.names = c("Var Num.","Count","Mean","Std. Dev.","Median", "Trimmed Mean", "MAD", "Minimum", "Maximum","Range", "Skewness", "Kurtosis", "S.E."),
      align="r") %>%
   kable_classic_2(full_width = F, html_font = "helvetica")

table2$vars
table2$sd
(table2$sd)^2

var_table<-data.frame(cbind(table2$vars, table2$sd,(table2$sd)^2))

colnames(var_table) = c("Var Num.", "Std. Dev.", "Variance")
rownames(var_table) = c("mental_health_days", "mental_distress_rate", "inequality", "median_inc", "hs_grad", "college", "unempl", "child_poverty","single_parent", "severe_housing", "food_index","mh_providers","pop_provider_ratio")

var_table %>%
  kbl(caption="Descriptive Statistics of Dataset - Std. Dev. & Variance ",
       format= "html", col.names = c("Var Num.", "Std. Dev.", "Variance"),
      align="r") %>%
   kable_classic_2(full_width = F, html_font = "helvetica")

```


## Graphs and Figures

**Assigned to:** Mark (with help from Shumel & Xuan)

For example, histograms, boxplots, scatterplots, line graphs (for aggregated annual data), etc. We should use the `ggplot()` function.

```{r graphs_init, results='hide'}

loadPkg("ggplot2")
loadPkg("patchwork") ## for combining graphs
loadPkg("purrr")
loadPkg("tidyr")
loadPkg("gridExtra")
loadPkg("ggpubr")

```

To visualize trends over time, we graphed several variables from the data, grouped by report year. Both measures of mental health have increased, but it's difficult to tell whether these increases are substantial. Notably, income inequality appears largely flat, while median income and unemployment have slightly improved.

```{r lines_annual, results='markup', message=F}

# use summ_by_year

# annual trends for mental health var
p1 <- ggplot(summ_by_year, aes(x=year)) +
  geom_line(aes(y = wmean_mh_days), lwd=1) + 
  expand_limits(y=c(0,5)) +
  labs(title = "Poor Mental Health Days", 
       x = "Report Year", y = "Avg for past 30 days") +
  theme_minimal()

p2 <- ggplot(summ_by_year, aes(x=year)) +
  geom_line(aes(y = wmean_mh_rate), lwd=1) + 
  expand_limits(y=c(0,.2)) +
  labs(title = "Frequent Mental Distress Rate", 
       x = "Report Year", y = "Percentage of Adults") + 
  theme_minimal()

# combine plots using patchwork package
p1 + p2

# annual trends for inequality and median income
p3 <- ggplot(summ_by_year, aes(x=year)) +
  geom_line(aes(y = wmean_inequality), lwd=1) + 
  expand_limits(y=c(0,5)) +
  labs(title = "Income Inequality", 
       x = "Report Year", y = "Ratio 80th : 20th pctl") +
  theme_minimal()

p4 <- ggplot(summ_by_year, aes(x=year)) +
  geom_line(aes(y = wmean_medinc / 1000), lwd=1) + 
  expand_limits(y=c(0,max(summ_by_year$wmean_medinc/1000)+5)) +
  labs(title = "Median Income", 
       x = "Report Year", y = "Thousands of Dollars") +
  theme_minimal()

p5 <- ggplot(summ_by_year, aes(x=year)) +
  geom_line(aes(y = wmean_unempl), lwd=1) + 
  expand_limits(y=c(0,.10)) +
  labs(title = "Unemployment Rate", 
       x = "Report Year", y = "Percent Unemployed") +
  theme_minimal()

# combine plots
#p3 / (p4 + p5)

grid.arrange(p1,p2, nrow=1, ncol=2)
grid.arrange(p3,p4,p5, nrow=1, ncol=3)

```

Next, we graphed the county-level data using scatterplots to compare the mental health measures with economic variables.

Both poor mental health days and the frequent mental distress rate are positively correlated with income inequality. When coloring the scatterplot by median income, counties with a lower median income tend toward the outer limits of the figure, which suggests that poorer counties generally have higher inequality and worse mental health. It's harder to infer a clear relationship when coloring the points by `pct_rural`, although the many of the highly unequal counties are heavily urban.

There is not much of a correlation between the mental health outcomes and the ratio of the population to mental health providers.

```{r scatter_a, results='markup'}

# data: use ranked
# colnames(ranked)

#-- Dependent vs Explanatory --#

# color = median income
color_value <- "Median Inc. ($T)"

c1 <- ggplot(ranked, aes(y=mental_health_days, x=inequality, color=median_inc/1000)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE, color="#a89968") +  ## Add linear regression line
  labs(title = "Scatterplot of Poor Mental Health Days vs. Inequality",
       y = 'Poor Mental Health Days per 30', x = 'Income Inequality Rate', 
       color = color_value)

c2 <- ggplot(ranked, aes(y=mental_distress_rate, x=inequality, color=median_inc/1000)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE, color="#a89968") + 
  labs(title = "Scatterplot of Frequent Distress vs. Inequality",
       y = 'Mental Distress Rate', x = 'Income Inequality Rate', 
       color = color_value)

# color = % rural
color_value <- "% Rural Pop."

c3 <- ggplot(ranked, aes(y=mental_health_days, x=inequality, color=pct_rural)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE, color="#a89968") +  ## Add linear regression line
  labs(title = "Scatterplot of Poor Mental Health Days vs. Inequality",
       y = 'Poor Mental Health Days per 30', x = 'Income Inequality Rate', 
       color = color_value)

c4 <- ggplot(ranked, aes(y=mental_distress_rate, x=inequality, color=pct_rural)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE, color="#a89968") + 
  labs(title = "Scatterplot of Frequent Distress vs. Inequality",
       y = 'Mental Distress Rate', x = 'Income Inequality Rate', 
       color = color_value)


#-- Dependent vs. Provision of Mental Health Care --#

# color = % rural
color_value <- "% Rural Pop."

c5 <- ggplot(ranked, aes(y=mental_health_days, x=pop_provider_ratio, color=pct_rural)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE, color="#a89968") + 
  labs(title = "Scatterplot of Poor Mental Health Days vs. Mental Health Providers",
       y = 'Poor Mental Health Days per 30', x = 'Ratio Population : Providers', 
       color = color_value)

c6 <- ggplot(ranked, aes(y=mental_distress_rate, x=pop_provider_ratio, color=pct_rural)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE, color="#a89968") + 
  labs(title = "Scatterplot of Frequent Distress vs. Mental Health Providers",
       y = 'Mental Distress Rate', x = 'Ratio Population : Providers', 
       color = color_value)


grid.arrange(c1,c2, nrow=1, ncol=2)
grid.arrange(c3,c4, nrow=1, ncol=2)
grid.arrange(c5,c6, nrow=1, ncol=2)

```

To get a better sense of how income inequality is associated with the other economic variables, we created a figure with multiple scatterplots. In general, the variables suggest the expected relationship: for example, `inequality` is positively correlated with unemployment, severe housing issues, and child poverty but negatively associated with a better food environment and high school graduation rates. Both `mental_health_days` and `mental_distress_rate` exhibit similarly signed correlations with the economic variables.

```{r scatter_b, results='markup'}

# Multi-plot figures

#-- Inequality vs. other economic variables --#

# unempl, child_poverty, hs_grad, college, single_parent, severe_housing, food_index

gg1 <- ggplot(ranked, aes(y=inequality, x=unempl)) + 
  geom_point() + 
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (a)")

gg2 <- ggplot(ranked, aes(y=inequality, x=severe_housing)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (b)")

gg3 <- ggplot(ranked, aes(y=inequality, x=child_poverty)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (c)")

gg4 <- ggplot(ranked, aes(y=inequality, x=single_parent)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (d)")

gg5 <- ggplot(ranked, aes(y=inequality, x=hs_grad)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (e)")

gg6 <- ggplot(ranked, aes(y=inequality, x=college)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (f)")

gg7 <- ggplot(ranked, aes(y=inequality, x=food_index)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (g)")

plot_list <- list(gg1, gg2, gg3, gg4, gg5, gg6, gg7)

do.call("grid.arrange", c(plot_list, ncol = 3))


#-- Dependent vs. other economic variables --#

# poor mental health days
gg1 <- ggplot(ranked, aes(y=mental_health_days, x=unempl)) + 
  geom_point() + 
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (a)")

gg2 <- ggplot(ranked, aes(y=mental_health_days, x=severe_housing)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (b)")

gg3 <- ggplot(ranked, aes(y=mental_health_days, x=child_poverty)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (c)")

gg4 <- ggplot(ranked, aes(y=mental_health_days, x=single_parent)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (d)")

gg5 <- ggplot(ranked, aes(y=mental_health_days, x=hs_grad)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (e)")

gg6 <- ggplot(ranked, aes(y=mental_health_days, x=college)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (f)")

gg7 <- ggplot(ranked, aes(y=mental_health_days, x=food_index)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (g)")

plot_list <- list(gg1, gg2, gg3, gg4, gg5, gg6, gg7)

do.call("grid.arrange", c(plot_list, ncol = 3))


# mental distress rate
gg1 <- ggplot(ranked, aes(y=mental_distress_rate, x=unempl)) + 
  geom_point() + 
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (a)")

gg2 <- ggplot(ranked, aes(y=mental_distress_rate, x=severe_housing)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (b)")

gg3 <- ggplot(ranked, aes(y=mental_distress_rate, x=child_poverty)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (c)")

gg4 <- ggplot(ranked, aes(y=mental_distress_rate, x=single_parent)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (d)")

gg5 <- ggplot(ranked, aes(y=mental_distress_rate, x=hs_grad)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (e)")

gg6 <- ggplot(ranked, aes(y=mental_distress_rate, x=college)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (f)")

gg7 <- ggplot(ranked, aes(y=mental_distress_rate, x=food_index)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE) + 
  labs(title = "Plot (g)")

plot_list <- list(gg1, gg2, gg3, gg4, gg5, gg6, gg7)

do.call("grid.arrange", c(plot_list, ncol = 3))


```

Because we are interested in whether the relationship between mental health and income inequality differs geographically, we also colored the points in the scatterplot by region.

An initial look by region is consistent with our previous takeaways from the aggregated region data. In general, counties in the South seem to have both relatively poor mental health and greater income inequality, while counties in the Midwest seem to do best on both dimensions. 

To make sure this relationship is not sensitive to report year, we also graphed the data for 2016 and 2021 separately. Overall, the trends are very similar to the multi-year data. The 2016 data for mental_health_days does look strange though, almost as if it's rounded to one decimal place. To be safe, we plotted the 2017 report data, which also corresponded nicely to the other years.

```{r scatter_c, results='markup'}

# data: use ranked
color_value <- "Region"

#-- All Years --#

p1 <- ggplot(ranked, aes(y=mental_health_days, x=inequality, color = factor(region))) + 
  geom_point(show.legend = F) +
  labs(title = paste("(a) Per 30 days"),
       y = 'Poor Mental Health days per 30', x = 'Income Inequality Rate', 
       color = color_value)

p2 <- ggplot(ranked, aes(y=mental_distress_rate, x=inequality, color = factor(region))) + 
  geom_point() + 
  labs(title = paste("(b) Percentage"),
       y = 'Frequent Distress Rate', x = 'Income Inequality Rate', 
       color = color_value)

p_all <- p1 + p2 + plot_annotation(title = "Scatterplot of Mental Health Variables vs. Income Inequality, 2016-2021")
p_all


#-- Is relationship sensitive to report year? --#

# 2016 vs 2021

# 2016
p1 <- ggplot(ranked16, aes(y=mental_health_days, x=inequality, color = factor(region))) + 
  geom_point(show.legend = F) +
  labs(title = "(a) Per 30 days",
       y = 'Poor Mental Health Days per 30', x = 'Income Inequality Rate', 
       color = color_value)

p2 <- ggplot(ranked16, aes(y=mental_distress_rate, x=inequality, color = factor(region))) + 
  geom_point() + 
  labs(title = "(b) Percentage",
       y = 'Frequent Distress Rate', x = 'Income Inequality Rate', 
       color = color_value)

p16 <- p1 + p2 + plot_annotation(title = "Scatterplot of Mental Health Variables vs. Income Inequality, 2016")
p16

# 2021
p1 <- ggplot(ranked21, aes(y=mental_health_days, x=inequality, color = factor(region))) + 
  geom_point(show.legend = F) +
  labs(title = "(a) Per 30 days",
       y = 'Poor Mental Health Days per 30', x = 'Income Inequality Rate', 
       color = color_value)

p2 <- ggplot(ranked21, aes(y=mental_distress_rate, x=inequality, color = factor(region))) + 
  geom_point() + 
  labs(title = "(b) Percentage",
       y = 'Frequent Distress Rate', x = 'Income Inequality Rate', 
       color = color_value)

p21 <- p1 + p2 + plot_annotation(title = "Scatterplot of Mental Health Variables vs. Income Inequality, 2021")
p21


# 2016 mental_health_days data looks weird (like it's been rounded)
# let's check 2017
p1 <- ggplot(ranked17, aes(y=mental_health_days, x=inequality, color = factor(region))) + 
  geom_point(show.legend = F) +
  labs(title = "(a) Per 30 days",
       y = 'Poor Mental Health Days per 30', x = 'Income Inequality Rate', 
       color = color_value)

p2 <- ggplot(ranked17, aes(y=mental_distress_rate, x=inequality, color = factor(region))) + 
  geom_point() + 
  labs(title = "(b) Percentage",
       y = 'Frequent Distress Rate', x = 'Income Inequality Rate', 
       color = color_value)

p17 <- p1 + p2 + plot_annotation(title = "Scatterplot of Mental Health Variables vs. Income Inequality, 2017")
p17


```

The county-level scatterplots look crowded because of all the data. So we also plotted the aggregated data by state, using the population-weighted means and statewide medians. The relationship between mental health and income inequality at this aggregated level is consistent with the disaggregated scatterplots.

```{r scatter_agg, results='markup'}

# data: use summ_by_year_state
# aggregated to the state level

#-- Dependent vs Explanatory --#

# means by state
color_value <- "Mean Median Inc ($T)"

ggplot(summ_by_year_state, aes(y=wmean_mh_days, x=wmean_inequality, color=wmean_medinc/1000)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE, color="#a89968") + 
  labs(title = "Scatterplot of Population-weighted Means by State",
       y = 'Poor Mental Health Days per 30', x = 'Income Inequality Rate', 
       color = color_value)

ggplot(summ_by_year_state, aes(y=wmean_mh_rate, x=wmean_inequality, color=wmean_medinc/1000)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE, color="#a89968") + 
  labs(title = "Scatterplot of Population-weighted Means by State",
       y = 'Mental Distress Rate', x = 'Income Inequality Rate', 
       color = color_value)

# medians by state
color_value <- "Med. Median Inc ($T)"

ggplot(summ_by_year_state, aes(y=med_mh_days, x=med_inequality, color=med_medinc/1000)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE, color="#a89968") +  ## Add linear regression line
  labs(title = "Scatterplot of Medians by State",
       y = 'Poor Mental Health Days per 30', x = 'Income Inequality Rate', 
       color = color_value)

ggplot(summ_by_year_state, aes(y=med_mh_rate, x=med_inequality, color=med_medinc/1000)) + 
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE, color="#a89968") + 
  labs(title = "Scatterplot of Medians by State",
       y = 'Mental Distress Rate', x = 'Income Inequality Rate', 
       color = color_value)


```

We also graphed histograms of many of the numeric variables to consider their distributions. Although none are perfectly "normal" distributions, many do seem to approximate normality. Most importantly, `mental_distress_rate` and `mental_health_days` have distributions that resemble normality. Generally, the economic variables – such as `inequality`, `median_inc`, and `unempl` – are left-skewed.

We will assess the normality of our data more thoroughly in a subsequent section.

```{r hist_multiple, results='markup'}

# https://www.r-bloggers.com/2016/07/quick-plot-of-all-variables/

# variables to plot
keep_var <- c('inequality', 'unempl', 'child_poverty', 'hs_grad', 'college', 'single_parent', 'severe_housing', 'food_index', 'mental_health_days', 'mental_distress_rate', 'median_inc', "mh_providers","pop_provider_ratio")

#ranked[keep_var]

# plot histograms
ranked[keep_var] %>% 
  gather() %>% 
  ggplot(aes(x=value)) + 
    facet_wrap(~ key, scales = "free") + 
    geom_histogram(bins=50, fill="light blue") + ggtitle("Histograms of Indepedent and Dependent Variables")+  xlab("Values")+ylab("Frequency")

# plot qq norm plots
ranked[keep_var] %>% 
  gather() %>% 
  ggplot(aes(sample=value))+ facet_wrap(~ key, scales = "free")+ stat_qq()+stat_qq_line(col="red")+ ggtitle("Normal Q-Q Plots of Indepedent and Dependent Variables") + xlab("Theoretical Quantities")+ylab("Sample Quantities")


total_ranked_shapiro = ranked[, c('mental_health_days', 'mental_distress_rate', 'inequality',"median_inc", "hs_grad", "college", "unempl", "child_poverty", "single_parent", "severe_housing", "food_index", "mh_providers", "pop_provider_ratio")]

shapiro.test(total_ranked_shapiro$mental_health_days[0:5000])

shapiro.test(total_ranked_shapiro$mental_distress_rate[0:5000])

shapiro.test(total_ranked_shapiro$inequality[0:5000])

shapiro.test(total_ranked_shapiro$median_inc[0:5000])

shapiro.test(total_ranked_shapiro$hs_grad[0:5000])

shapiro.test(total_ranked_shapiro$college[0:5000])men

shapiro.test(total_ranked_shapiro$unempl[0:5000])

shapiro.test(total_ranked_shapiro$child_poverty[0:5000])

shapiro.test(total_ranked_shapiro$single_parent[0:5000])

shapiro.test(total_ranked_shapiro$severe_housing[0:5000])

shapiro.test(total_ranked_shapiro$food_index[0:5000])
       
shapiro.test(total_ranked_shapiro$mh_providers[0:5000])

shapiro.test(total_ranked_shapiro$pop_provider_ratio[0:5000])
       

cor.test(ranked$inequality, ranked$mental_health_days,method = "spearman", exact = FALSE)

cor.test(ranked$inequality, ranked$mental_distress_rate, method = "spearman", exact = FALSE)

cor.test(ranked$median_inc, ranked$mental_health_days, method = "spearman", exact = FALSE)

cor.test(ranked$median_inc, ranked$mental_distress_rate, method = "spearman", exact = FALSE)




```

[INSERT brief summary of boxplots]

To better show the relationship between the economic variables and mental health in different regions of the United States, we generated boxplots of the data by region. To highlight the key points, we only focus on two independent variables (`inequality` and `median_inc`) and two dependent variables (`mental_health_days` and `mental_distress_rate`).

```{r boxplots, results='markup'}

##Assigned to: Xuan
# In this part, in order to better show the relationship between the economic level and mental health of people, mental_distress_rate in different regions of the United States, I divided the United States into 4 regions by geographical method (for details, you can check this link below). I will analyze the four parts of "Northeast", "South", "West", "Midwest" separately.(https://www2.census.gov/geo/pdfs/maps-data/maps/reference/us_regdiv.pdf) In addition, I would like to say that there are many independent variables and dependent variables selected by our group, but in order to shorten the space and highlight the key points, I only select two independent variables and two dependent variable for analysis. The two independent variables that I selected are "Median household income" (median_inc) and "Income inequality" (inequality). The two dependent variable that I selected is "Poor mental health days" (mental_health_days) and "Frequent mental distress rate" (mental_distress_rate).

dframe0NA <- na.omit(dframe)
# In the above code, I remove all NA of the dframe and save it as dframe0NA.
#View(dframe0NA)

# update labels for easier reading
levels(dframe0NA$region) <- c("", 
                              "MW",  # re-level factor labels
                              "NE",
                              "S", 
                              "W")


dframe2016 = subset(dframe0NA, year == 2016)
dframe2017 = subset(dframe0NA, year == 2017)
dframe2018 = subset(dframe0NA, year == 2018)
dframe2019 = subset(dframe0NA, year == 2019)
dframe2020 = subset(dframe0NA, year == 2020)
dframe2021 = subset(dframe0NA, year == 2021)
# In the above code, I divided dframe0NA into 6 subsets by year, from 2016 to 2021. This makes subsequent drawings easier.

dframeNortheast = subset(dframe0NA, region == "NE")
dframeSouth = subset(dframe0NA, region == "S")
dframeWest = subset(dframe0NA, region == "W")
dframeMidwest = subset(dframe0NA, region == "MW")
# In the above code, I divided dframe0NA into 4 subsets by regions. This makes subsequent drawings easier.

loadPkg("ggplot2")
dframe$year <- factor(dframe$year)
# In the above code, I set "year" as a factor variable. Frankly speaking, this step can be done earlier. In the below codes, because what I went to draw was some boxplots, which usually only represents one variable, I designed the code in order to be able to relate the variable to different regions (the U.S. is divided into four geographic regions). In each box plot, you can see the one variable in different regions.

```

The following 6 boxplots show the median household income of 4 regions from 2016 to 2021. The trend across years are the same. The Northeast region has the largest median household income, followed by the West region. This makes sense because New York (the biggest city in US) is in the Northeast, and LA (the second biggest city in US) is in the West. In addition, median household incomes in the Midwest and the South are relatively low. But the gap between rich and poor in the Midwest and South is relatively small.

```{r boxplots_median_inc, results='markup'}

##Assigned to: Xuan
##### Characterizations of the Median household income of four regions in the United States from 2016 to 2021.
##### The following 6 photographs, show the median household income of 4 regions from 2016 to 2021 (6 years). So I mean, one photograph is related to one year. And the trend of these 6 photographs are same. It is easy to find that the median household income of northeast region is the biggest. Followed by west region. It's not difficult to understand, the northeast region has New York, the biggest city in US, the west region has LA, the second biggest city in US. In addition, the median household income of midwest region and south region are relatively low. But the gap between rich and poor in the midwest and south is relatively small.

# Characterization of the Median household income of four regions in the United States in 2016.
b1 <- ggplot(ranked16, aes(x=region, y=median_inc)) + 
  geom_boxplot() + 
  geom_boxplot(colour="#4682B4",fill="#B6D0E2",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="2016")

# Characterization of the Median household income of four regions in the United States in 2017.
b2 <-ggplot(ranked17, aes(x=region, y=median_inc)) + 
  geom_boxplot() + 
  geom_boxplot(colour="#4682B4",fill="#B6D0E2",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="2017")

# Characterization of the Median household income of four regions in the United States in 2018.
b3 <-ggplot(ranked18, aes(x=region, y=median_inc)) + 
  geom_boxplot() + 
  geom_boxplot(colour="#4682B4",fill="#B6D0E2",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="2018")

# Characterization of the Median household income of four regions in the United States in 2019.
b4 <-ggplot(ranked19, aes(x=region, y=median_inc)) + 
  geom_boxplot() + 
  geom_boxplot(colour="#4682B4",fill="#B6D0E2",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="2019")

# Characterization of the Median household income of four regions in the United States in 2020.
b5 <-ggplot(ranked20, aes(x=region, y=median_inc)) + 
  geom_boxplot() + 
  geom_boxplot(colour="#4682B4",fill="#B6D0E2",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="2020")

# Characterization of the Median household income of four regions in the United States in 2021.
b6 <-ggplot(ranked21, aes(x=region, y=median_inc)) + 
  geom_boxplot() + 
  geom_boxplot(colour="#4682B4",fill="#B6D0E2",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="2021")

boxplot1 <- grid.arrange(b1,b2,b3,b4,b5,b6, nrow=2, ncol=3, top = text_grob("Boxplots of Median Income by Region per Year", color = "black", face = "bold", size = 14))

```

From the four boxplots below, we can see that median household income has a gradually upward trend in all 4 regions from 2016 to 2021. For example, the median household income in the South was about $40,000 in 2016, and by 2021, it was close to $50,000.

```{r boxplots_median_inc_region, results='markup'}
##### Characterizations of the Median household income of four regions from 2016 to 2021, decided by regions.
##### From the four photographs below, we can see that the trend of median household income in all 4 regions gradually upward from 2016 to 2021. For example, in south region, the median household income in 2016 was about $40,000, and by 2021, it was close to $50,000.

# Characterization of the Median household income of northeast region from 2016 to 2021.
ggplot(dframeNortheast, aes(x=year, y=median_inc)) +
  geom_boxplot() +
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="The trend of median_inc of northeast region from 2016 to 2021")

# Characterization of the Median household income of south region from 2016 to 2021.
ggplot(dframeSouth, aes(x=year, y=median_inc)) +
  geom_boxplot() +
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="The trend of median_inc of south region from 2016 to 2021")

# Characterization of the Median household income of west region from 2016 to 2021.
ggplot(dframeWest, aes(x=year, y=median_inc)) +
  geom_boxplot() +
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="The trend of median_inc of west region from 2016 to 2021")

# Characterization of the Median household income of midwest region from 2016 to 2021.
ggplot(dframeMidwest, aes(x=year, y=median_inc)) +
  geom_boxplot() +
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="The trend of median_inc of midwest region from 2016 to 2021")
```

The following 6 boxplots show the income inequality of 4 regions from 2016 to 2021. The trend of these 6 plots are similar. Income inequality is biggest in the South. This also happens to validate the six plots above for median household income. The South, which has the lowest median household income, is likely to have the greatest income inequality problem.

```{r boxplots_inequality, results='markup'}
##Assigned to: Xuan
##### Characterizations of Income inequality of four regions in the United States from 2016 to 2021.
##### The following 6 photographs, show the income inequality of 4 regions from 2016 to 2021 (6 years). So I mean, one photograph is related to one year. And the trend of these 6 photographs are same. From these 6 photographs, we can find that the income inequality of south region is biggest.This also happens to validate the six plots above for median household income. The South, which has the lowest median household income, is likely to have the greatest income inequality problem.

# Characterization of Income inequality of four regions in the United States in 2016.
b15<-ggplot(ranked16, aes(x=region, y=inequality)) + 
  geom_boxplot() + 
  geom_boxplot(colour="#4682B4",fill="#B6D0E2",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="2016")

# Characterization of Income inequality of four regions in the United States in 2017.
b25<-ggplot(ranked17, aes(x=region, y=inequality)) + 
  geom_boxplot() + 
  geom_boxplot(colour="#4682B4",fill="#B6D0E2",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="2017")

# Characterization of Income inequality of four regions in the United States in 2018.
b35<-ggplot(ranked18, aes(x=region, y=inequality)) + 
  geom_boxplot() + 
  geom_boxplot(colour="#4682B4",fill="#B6D0E2",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="2018")

# Characterization of Income inequality of four regions in the United States in 2019.
b45<-ggplot(ranked19, aes(x=region, y=inequality)) + 
  geom_boxplot() + 
  geom_boxplot(colour="#4682B4",fill="#B6D0E2",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="2019")

# Characterization of Income inequality in four regions of the United States in 2020.
b55<-ggplot(ranked20, aes(x=region, y=inequality)) + 
  geom_boxplot() + 
  geom_boxplot(colour="#4682B4",fill="#B6D0E2",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="2020")

# Characterization of Income inequality of four regions in the United States in 2021.
b65<-ggplot(ranked21, aes(x=region, y=inequality)) + 
  geom_boxplot() + 
  geom_boxplot(colour="#4682B4",fill="#B6D0E2",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="2021")

boxplot1_5 <- grid.arrange(b15,b25,b35,b45,b55,b65, nrow=2, ncol=3, top = text_grob("Boxplots of Inequality by Region per Year", color = "black", face = "bold", size = 14))
```

Across all regions, income inequality has not changed much from 2016 to 2021. For example, in the Northeast region, it has been around 4.4% for each report year.

```{r boxplots_inequality_region, results='markup'}
##### Characterizations of the income inequality of four regions from 2016 to 2021, decided by regions.
##### From the four photographs below, we can easily find that, no matter which region it is, the status of income inequality has not changed much from 2016 to 2021. For example, in the Northeast region, it has been around 4.4% for 6 consecutive years. This kind of data result could provide some advice for local governments to continue working to reduce or even eliminate income inequality.

# Characterization of the income inequality of northeast region from 2016 to 2021.
ggplot(dframeNortheast, aes(x=year, y=inequality)) +
  geom_boxplot() +
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="The trend of Income inequality of northeast region from 2016 to 2021")

# Characterization of the income inequality of south region from 2016 to 2021.
ggplot(dframeSouth, aes(x=year, y=inequality)) +
  geom_boxplot() +
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="The trend of Income inequality of south region from 2016 to 2021")

# Characterization of the income inequality of west region from 2016 to 2021.
ggplot(dframeWest, aes(x=year, y=inequality)) +
  geom_boxplot() +
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="The trend of Income inequality of west region from 2016 to 2021")

# Characterization of the income inequality of midwest region from 2016 to 2021.
ggplot(dframeMidwest, aes(x=year, y=inequality)) +
  geom_boxplot() +
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="The trend of Income inequality of midwest region from 2016 to 2021")
```

The south region has the highest amount of average poor mental health days. This is consistent with our previous findings. For example, because the South has the lowest median household income of the four regions, people in the South could be more likely to be unhappy.

```{r boxplots_mh_days, results='markup'}
##Assigned to: Xuan
##### Characterizations of the Poor mental health days/month of four regions in the United States from 2016 to 2021.
##### In the following 6 photographs, we can easily find that the south region has the biggest poor mental health days. This is consistent with our previous findings. The South has the lowest median household income of the four regions. So, people in the South are more likely to be unhappy.

# Characterization of the Poor mental health days/month of four regions in the United States in 2016.
b7<-ggplot(ranked16, aes(x=region, y=mental_health_days)) + 
  geom_boxplot() + 
  geom_boxplot(colour="#4682B4",fill="#B6D0E2",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="2016")

# Characterization of the Poor mental health days/month of four regions in the United States in 2017.
b8<-ggplot(ranked17, aes(x=region, y=mental_health_days)) + 
  geom_boxplot() + 
  geom_boxplot(colour="#4682B4",fill="#B6D0E2",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="2017")

# Characterization of the Poor mental health days/month of four regions in the United States in 2018.
b9<-ggplot(ranked18, aes(x=region, y=mental_health_days)) + 
  geom_boxplot() + 
  geom_boxplot(colour="#4682B4",fill="#B6D0E2",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="2018")

# Characterization of the Poor mental health days/month of four regions in the United States in 2019.
b10<-ggplot(ranked19, aes(x=region, y=mental_health_days)) + 
  geom_boxplot() + 
  geom_boxplot(colour="#4682B4",fill="#B6D0E2",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="2019")

# Characterization of the Poor mental health days/month of four regions in the United States in 2020.
b11<-ggplot(ranked20, aes(x=region, y=mental_health_days)) + 
  geom_boxplot() + 
  geom_boxplot(colour="#4682B4",fill="#B6D0E2",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="2020")

# Characterization of the Poor mental health days/month of four regions in the United States in 2021.
b12<-ggplot(ranked21, aes(x=region, y=mental_health_days)) + 
  geom_boxplot() + 
  geom_boxplot(colour="#4682B4",fill="#B6D0E2",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="2021")

boxplot2 <- grid.arrange(b7,b8,b9,b10,b11,b12, nrow=2, ncol=3, top = text_grob("Boxplots of Mentally Unhealthy Days by Region per Year", color = "black", face = "bold", size = 14))

```

The following boxplots suggest that the number of poor mental health days is gradually going up in all regions.

```{r boxplots_mh_days_region, results='markup'}
##Assigned to: Xuan
##### Characterizations of the Poor mental health days/month of 4 regions from 2016 to 2021
##### From following 4 photographs, we can easily find that the poor mental health days gradually go up, no matter in which region. Combined with the results of the previous findings, even though the income of local people is increasing year by year, their unhappy time is still increasing. My guess is that income growth is not keeping up with local prices.

# Characterization of the Poor mental health days/month of northeast region from 2016 to 2021.
ggplot(dframeNortheast, aes(x=year, y=mental_health_days)) + 
  geom_boxplot() + 
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="mental unhealthy days/month of northeast region from 2016 to 2021")

# Characterization of the Poor mental health days/month of south region from 2016 to 2021.
ggplot(dframeSouth, aes(x=year, y=mental_health_days)) + 
  geom_boxplot() + 
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="mental unhealthy days/month of south region from 2016 to 2021")

# Characterization of the Poor mental health days/month of west region from 2016 to 2021.
ggplot(dframeWest, aes(x=year, y=mental_health_days)) + 
  geom_boxplot() + 
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="mental unhealthy days/month of west region from 2016 to 2021")

# Characterization of the Poor mental health days/month of midwest region from 2016 to 2021.
ggplot(dframeMidwest, aes(x=year, y=mental_health_days)) + 
  geom_boxplot() + 
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="mental unhealthy days/month of midwest region from 2016 to 2021")
```

The following boxplots of `mental_distress_rate` show similar results as the previous figures of `mental_health_days`.

```{r boxplots_md_rate, results='markup'}
##Assigned to: Xuan
##### Characterizations of the Frequent mental distress rate of four regions in the United States from 2016 to 2021.
##### The following 6 photographs shows the similar results as the above "Characterizations of the Poor mental health days/month of four regions in the United States from 2016 to 2021". Stress, nervousness, and mentally unhealthy emotions are all related to income. The lower the income, the more stressful it is. Just like south region.

# Characterization of the Frequent mental distress rate of four regions in the United States in 2016.
b13<-ggplot(ranked16, aes(x=region, y=mental_distress_rate)) + 
  geom_boxplot() + 
  geom_boxplot(colour="#4682B4",fill="#B6D0E2",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="2016")

# Characterization of the Frequent mental distress rate of four regions in the United States in 2017.
b14<-ggplot(ranked17, aes(x=region, y=mental_distress_rate)) + 
  geom_boxplot() + 
  geom_boxplot(colour="#4682B4",fill="#B6D0E2",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="2017")

# Characterization of the Frequent mental distress rate of four regions in the United States in 2018.
b15<-ggplot(ranked18, aes(x=region, y=mental_distress_rate)) + 
  geom_boxplot() + 
  geom_boxplot(colour="#4682B4",fill="#B6D0E2",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="2018")

# Characterization of the Frequent mental distress rate of four regions in the United States in 2019.
b16<-ggplot(ranked19, aes(x=region, y=mental_distress_rate)) + 
  geom_boxplot() + 
  geom_boxplot(colour="#4682B4",fill="#B6D0E2",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="2019")

# Characterization of the Frequent mental distress rate of four regions in the United States in 2020.
b17<-ggplot(ranked20, aes(x=region, y=mental_distress_rate)) + 
  geom_boxplot() + 
  geom_boxplot(colour="#4682B4",fill="#B6D0E2",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="2020")

# Characterization of the Frequent mental distress rate of four regions in the United States in 2021.
b18<-ggplot(ranked21, aes(x=region, y=mental_distress_rate)) + 
  geom_boxplot() + 
  geom_boxplot(colour="#4682B4",fill="#B6D0E2",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="2021")

boxplot3 <- grid.arrange(b13,b14,b15,b15,b17,b18, nrow=2, ncol=3, top = text_grob("Boxplots of Frequent Mental Distress Rate by Region per Year", color = "black", face = "bold", size = 14))

```

```{r boxplots_md_rate_region, results='markup'}
##Assigned to: Xuan
##### Characterizations of the Frequent mental distress rate of 4 regions from 2016 to 2021
##### From following 4 photographs, we can easily find that the frequent mental distress rate gradually goes up, no matter in which region. Combined with the results of the previous findings, even though the income of local people is increasing year by year, it is still easy for then to feel stressed. My guess is that income growth is not keeping up with local prices. Maybe because of COVID-19, we can see that the trend from 2020 to 2021 is more obvious than previous years.

# Characterization of the Frequent mental distress rate of northeast region from 2016 to 2021.
ggplot(dframeNortheast, aes(x=year, y=mental_distress_rate)) + 
  geom_boxplot() + 
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="Frequent mental distress rate of northeast region from 2016 to 2021")

# Characterization of the Frequent mental distress rate of south region from 2016 to 2021.
ggplot(dframeSouth, aes(x=year, y=mental_distress_rate)) + 
  geom_boxplot() + 
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="Frequent mental distress rate of south region from 2016 to 2021")

# Characterization of the Frequent mental distress rate of west region from 2016 to 2021.
ggplot(dframeWest, aes(x=year, y=mental_distress_rate)) + 
  geom_boxplot() + 
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="Frequent mental distress rate of west region from 2016 to 2021")

# Characterization of the Frequent mental distress rate of midwest region from 2016 to 2021.
ggplot(dframeMidwest, aes(x=year, y=mental_distress_rate)) + 
  geom_boxplot() + 
  geom_boxplot(colour="orange",fill="#7777cc",outlier.colour="red",outlier.shape=8, outlier.size=4) +
  labs(title="Frequent mental distress rate of midwest region from 2016 to 2021")
```

## Measures of Variation
*When applicable.*

**Assigned to:** Xuan

```{r variance, results='markup'}

# Variance, standard of median_inc of different region from 2016 to 2021.
var(dframeNortheast$median_inc)
var(dframeSouth$median_inc)
var(dframeWest$median_inc)
var(dframeMidwest$median_inc)

sd(dframeNortheast$median_inc)
sd(dframeSouth$median_inc)
sd(dframeWest$median_inc)
sd(dframeMidwest$median_inc)
#From above data, we can see the Northeast region's people has the largest gap between the rich and the poor, and the Midwest has the smallest gap.

# Variance, standard of inequality of different region from 2016 to 2021.
var(dframeNortheast$inequality)
var(dframeSouth$inequality)
var(dframeWest$inequality)
var(dframeMidwest$inequality)

sd(dframeNortheast$inequality)
sd(dframeSouth$inequality)
sd(dframeWest$inequality)
sd(dframeMidwest$inequality)
#From above data, we can see the South region's people has the largest income inequality.

# Variance, standard of mental_distress_rate of different region from 2016 to 2021.
var(dframeNortheast$mental_distress_rate)
var(dframeSouth$mental_distress_rate)
var(dframeWest$mental_distress_rate)
var(dframeMidwest$mental_distress_rate)

sd(dframeNortheast$mental_distress_rate)
sd(dframeSouth$mental_distress_rate)
sd(dframeWest$mental_distress_rate)
sd(dframeMidwest$mental_distress_rate)
#From above data, we can see the South region's people has the largest mental distress (maybe because of low income), and the Northeast has the smallest mental distress (maybe because they have much more money).

# Variance, standard of mental_health_days of different region from 2016 to 2021.
var(dframeNortheast$mental_health_days)
var(dframeSouth$mental_health_days)
var(dframeWest$mental_health_days)
var(dframeMidwest$mental_health_days)

sd(dframeNortheast$mental_health_days)
sd(dframeSouth$mental_health_days)
sd(dframeWest$mental_health_days)
sd(dframeMidwest$mental_health_days)
#From above data, we can see the South region's people has the largest mental unhealthy days/month (maybe because of low income), and the Northeast has the smallest mental unhealthy days/month (maybe because they have much more money).

```

[GO back and fill in inline R]
From above data, we can see the Northeast region's people has the largest gap between the rich and the poor, and the Midwest has the smallest gap.

From above data, we can see the South region's people has the largest income inequality.

From above data, we can see the South region's people has the largest mental distress (maybe because of low income), and the Northeast has the smallest mental distress (maybe because they have much more money).

From above data, we can see the South region's people has the largest mental unhealthy days/month (maybe because of low income), and the Northeast has the smallest mental unhealthy days/month (maybe because they have much more money).


## Normality tests
*When applicable.*

**Assigned to:** Shumel

```{r norm_a, results='markup', warning=FALSE}

# density plot of all the variable for every year

ggplot(dframe, aes(x = mental_distress_rate , color = year, fill = year)) + geom_density(alpha = 0.5)
ggplot(dframe, aes(x = mental_health_days , color = year, fill = year)) + geom_density(alpha = 0.5)
ggplot(dframe, aes(x = inequality , color = year, fill = year)) + geom_density(alpha = 0.5)
ggplot(dframe, aes(x = median_inc , color = year, fill = year)) + geom_density(alpha = 0.5)
ggplot(dframe, aes(x = hs_grad , color = year, fill = year)) + geom_density(alpha = 0.5)
ggplot(dframe, aes(x = college , color = year, fill = year)) + geom_density(alpha = 0.5)
ggplot(dframe, aes(x = unempl , color = year, fill = year)) + geom_density(alpha = 0.5)
ggplot(dframe, aes(x = child_poverty , color = year, fill = year)) + geom_density(alpha = 0.5)
ggplot(dframe, aes(x = single_parent , color = year, fill = year)) + geom_density(alpha = 0.5)
ggplot(dframe, aes(x = severe_housing , color = year, fill = year)) + geom_density(alpha = 0.5)
ggplot(dframe, aes(x = food_index , color = year, fill = year)) + geom_density(alpha = 0.5)
ggplot(dframe, aes(x = mh_providers , color = year, fill = year)) + geom_density(alpha = 0.5)
ggplot(dframe, aes(x = pop_provider_ratio , color = year, fill = year)) + geom_density(alpha = 0.5)
ggplot(dframe, aes(x = pop , color = year, fill = year)) + geom_density(alpha = 0.5)
ggplot(dframe, aes(x = pct_below18 , color = year, fill = year)) + geom_density(alpha = 0.5)
ggplot(dframe, aes(x = pct_black , color = year, fill = year)) + geom_density(alpha = 0.5)
ggplot(dframe, aes(x = pct_native_am , color = year, fill = year)) + geom_density(alpha = 0.5)
ggplot(dframe, aes(x = pct_asian , color = year, fill = year)) + geom_density(alpha = 0.5)
ggplot(dframe, aes(x = pct_hispanic , color = year, fill = year)) + geom_density(alpha = 0.5)
ggplot(dframe, aes(x = pct_white , color = year, fill = year)) + geom_density(alpha = 0.5)
ggplot(dframe, aes(x = pct_rural , color = year, fill = year)) + geom_density(alpha = 0.5)

```

```{r norm_b, warning=FALSE, results='markup'}

# normality test of as per year
#mental distress rate

ggdensity(dframe2016$mental_distress_rate, 
          main = "Density plot of mental_distress_rate",
          xlab = "mental_distress_rate")
ggqqplot(dframe2016$mental_distress_rate)
qqnorm(dframe2016$mental_distress_rate)
qqline(dframe2016$mental_distress_rate, col = "blue")
shapiro.test(dframe2016$mental_distress_rate)


ggdensity(dframe2017$mental_distress_rate, 
          main = "Density plot of mental_distress_rate",
          xlab = "mental_distress_rate")
ggqqplot(dframe2017$mental_distress_rate)
qqnorm(dframe2017$mental_distress_rate)
qqline(dframe2017$mental_distress_rate, col = "blue")
shapiro.test(dframe2017$mental_distress_rate)


ggdensity(dframe2018$mental_distress_rate, 
          main = "Density plot of mental_distress_rate",
          xlab = "mental_distress_rate")
ggqqplot(dframe2018$mental_distress_rate)
qqnorm(dframe2018$mental_distress_rate)
qqline(dframe2018$mental_distress_rate, col = "blue")
shapiro.test(dframe2018$mental_distress_rate)    


ggdensity(dframe2019$mental_distress_rate, 
          main = "Density plot of mental_distress_rate",
          xlab = "mental_distress_rate")
ggqqplot(dframe2019$mental_distress_rate)
qqnorm(dframe2019$mental_distress_rate)
qqline(dframe2019$mental_distress_rate, col = "blue")
shapiro.test(dframe2019$mental_distress_rate)

ggdensity(dframe2020$mental_distress_rate, 
          main = "Density plot of mental_distress_rate",
          xlab = "mental_distress_rate")
ggqqplot(dframe2020$mental_distress_rate)
qqnorm(dframe2020$mental_distress_rate)
qqline(dframe2020$mental_distress_rate, col = "blue")
shapiro.test(dframe2020$mental_distress_rate)

ggdensity(dframe2021$mental_distress_rate, 
          main = "Density plot of mental_distress_rate",
          xlab = "mental_distress_rate")
ggqqplot(dframe2021$mental_distress_rate)
qqnorm(dframe2021$mental_distress_rate)
qqline(dframe2021$mental_distress_rate, col = "blue")
shapiro.test(dframe2021$mental_distress_rate)

```


```{r norm_c, results='markup', warning=FALSE}

# mental health days

ggdensity(dframe2016$mental_health_days, 
          main = "Density plot of mental_health_days",
          xlab = "mental_health_days")
ggqqplot(dframe2016$mental_health_days)
qqnorm(dframe2016$mental_health_days)
qqline(dframe2016$mental_health_days, col = "blue")
shapiro.test(dframe2016$mental_health_days)



ggdensity(dframe2017$mental_health_days, 
          main = "Density plot of mental_health_days",
          xlab = "mental_health_days")
ggqqplot(dframe2017$mental_health_days)
qqnorm(dframe2017$mental_health_days)
qqline(dframe2017$mental_health_days, col = "blue")
shapiro.test(dframe2017$mental_health_days)


ggdensity(dframe2018$mental_health_days, 
          main = "Density plot of mental_health_days",
          xlab = "mental_health_days")
ggqqplot(dframe2018$mental_health_days)
qqnorm(dframe2018$mental_health_days)
qqline(dframe2018$mental_health_days, col = "blue")
shapiro.test(dframe2018$mental_health_days)    


ggdensity(dframe2019$mental_health_days, 
          main = "Density plot of mental_health_days",
          xlab = "mental_health_days")
ggqqplot(dframe2019$mental_health_days)
qqnorm(dframe2019$mental_health_days)
qqline(dframe2019$mental_health_days, col = "blue")
shapiro.test(dframe2019$mental_health_days)

ggdensity(dframe2020$mental_health_days, 
          main = "Density plot of mental_health_days",
          xlab = "mental_health_days")
ggqqplot(dframe2020$mental_health_days)
qqnorm(dframe2020$mental_health_days)
qqline(dframe2020$mental_health_days, col = "blue")
shapiro.test(dframe2020$mental_health_days)

ggdensity(dframe2021$mental_health_days, 
          main = "Density plot of mental_health_days",
          xlab = "mental_health_days")
ggqqplot(dframe2021$mental_health_days)
qqnorm(dframe2021$mental_health_days)
qqline(dframe2021$mental_health_days, col = "blue")
shapiro.test(dframe2021$mental_health_days)

```

```{r norm_d, results='markup', warning=FALSE}

#
# inequality

ggdensity(dframe2016$inequality, 
          main = "Density plot of inequality",
          xlab = "inequality")
ggqqplot(dframe2016$inequality)
qqnorm(dframe2016$inequality)
qqline(dframe2016$inequality, col = "blue")
shapiro.test(dframe2016$inequality)



ggdensity(dframe2017$inequality, 
          main = "Density plot of inequality",
          xlab = "inequality")
ggqqplot(dframe2017$inequality)
qqnorm(dframe2017$inequality)
qqline(dframe2017$inequality, col = "blue")
shapiro.test(dframe2017$inequality)


ggdensity(dframe2018$inequality, 
          main = "Density plot of inequality",
          xlab = "inequality")
ggqqplot(dframe2018$inequality)
qqnorm(dframe2018$inequality)
qqline(dframe2018$inequality, col = "blue")
shapiro.test(dframe2018$inequality)    


ggdensity(dframe2019$inequality, 
          main = "Density plot of inequality",
          xlab = "inequality")
ggqqplot(dframe2019$inequality)
qqnorm(dframe2019$inequality)
qqline(dframe2019$inequality, col = "blue")
shapiro.test(dframe2019$inequality)

ggdensity(dframe2020$inequality, 
          main = "Density plot of inequality",
          xlab = "inequality")
ggqqplot(dframe2020$inequality)
qqnorm(dframe2020$inequality)
qqline(dframe2020$inequality, col = "blue")
shapiro.test(dframe2020$inequality)

ggdensity(dframe2021$inequality, 
          main = "Density plot of inequality",
          xlab = "inequality")
ggqqplot(dframe2021$inequality)
qqnorm(dframe2021$inequality)
qqline(dframe2021$inequality, col = "blue")
shapiro.test(dframe2021$inequality)

```

```{r norm_e, results='markup', warning=FALSE}

#
# median inc

ggdensity(dframe2016$median_inc, 
          main = "Density plot of median_inc",
          xlab = "median_inc")
ggqqplot(dframe2016$median_inc)
qqnorm(dframe2016$median_inc)
qqline(dframe2016$median_inc, col = "blue")
shapiro.test(dframe2016$median_inc)



ggdensity(dframe2017$median_inc, 
          main = "Density plot of median_inc",
          xlab = "median_inc")
ggqqplot(dframe2017$median_inc)
qqnorm(dframe2017$median_inc)
qqline(dframe2017$median_inc, col = "blue")
shapiro.test(dframe2017$median_inc)


ggdensity(dframe2018$median_inc, 
          main = "Density plot of median_inc",
          xlab = "median_inc")
ggqqplot(dframe2018$median_inc)
qqnorm(dframe2018$median_inc)
qqline(dframe2018$median_inc, col = "blue")
shapiro.test(dframe2018$median_inc)    


ggdensity(dframe2019$median_inc, 
          main = "Density plot of median_inc",
          xlab = "median_inc")
ggqqplot(dframe2019$median_inc)
qqnorm(dframe2019$median_inc)
qqline(dframe2019$median_inc, col = "blue")
shapiro.test(dframe2019$median_inc)

ggdensity(dframe2020$median_inc, 
          main = "Density plot of median_inc",
          xlab = "median_inc")
ggqqplot(dframe2020$median_inc)
qqnorm(dframe2020$median_inc)
qqline(dframe2020$median_inc, col = "blue")
shapiro.test(dframe2020$median_inc)

ggdensity(dframe2021$median_inc, 
          main = "Density plot of median_inc",
          xlab = "median_inc")
ggqqplot(dframe2021$median_inc)
qqnorm(dframe2021$median_inc)
qqline(dframe2021$median_inc, col = "blue")
shapiro.test(dframe2021$median_inc)

```


```{r norm_f, results='markup', warning=FALSE, include=FALSE}

#
# hs grad

ggdensity(dframe2016$hs_grad, 
          main = "Density plot of hs_grad",
          xlab = "hs_grad")
ggqqplot(dframe2016$hs_grad)
qqnorm(dframe2016$hs_grad)
qqline(dframe2016$hs_grad, col = "blue")
shapiro.test(dframe2016$hs_grad)



ggdensity(dframe2017$hs_grad, 
          main = "Density plot of hs_grad",
          xlab = "hs_grad")
ggqqplot(dframe2017$hs_grad)
qqnorm(dframe2017$hs_grad)
qqline(dframe2017$hs_grad, col = "blue")
shapiro.test(dframe2017$hs_grad)


ggdensity(dframe2018$hs_grad, 
          main = "Density plot of hs_grad",
          xlab = "hs_grad")
ggqqplot(dframe2018$hs_grad)
qqnorm(dframe2018$hs_grad)
qqline(dframe2018$hs_grad, col = "blue")
shapiro.test(dframe2018$hs_grad)    


ggdensity(dframe2019$hs_grad, 
          main = "Density plot of hs_grad",
          xlab = "hs_grad")
ggqqplot(dframe2019$hs_grad)
qqnorm(dframe2019$hs_grad)
qqline(dframe2019$hs_grad, col = "blue")
shapiro.test(dframe2019$hs_grad)

ggdensity(dframe2020$hs_grad, 
          main = "Density plot of hs_grad",
          xlab = "hs_grad")
ggqqplot(dframe2020$hs_grad)
qqnorm(dframe2020$hs_grad)
qqline(dframe2020$hs_grad, col = "blue")
shapiro.test(dframe2020$hs_grad)

ggdensity(dframe2021$hs_grad, 
          main = "Density plot of hs_grad",
          xlab = "hs_grad")
ggqqplot(dframe2021$hs_grad)
qqnorm(dframe2021$hs_grad)
qqline(dframe2021$hs_grad, col = "blue")
shapiro.test(dframe2021$hs_grad)

```

```{r norm_g, results='markup', warning=F, include=F}

#
# college

ggdensity(dframe2016$college, 
          main = "Density plot of college",
          xlab = "college")
ggqqplot(dframe2016$college)
qqnorm(dframe2016$college)
qqline(dframe2016$college, col = "blue")
shapiro.test(dframe2016$college)



ggdensity(dframe2017$college, 
          main = "Density plot of college",
          xlab = "college")
ggqqplot(dframe2017$college)
qqnorm(dframe2017$college)
qqline(dframe2017$college, col = "blue")
shapiro.test(dframe2017$college)


ggdensity(dframe2018$college, 
          main = "Density plot of college",
          xlab = "college")
ggqqplot(dframe2018$college)
qqnorm(dframe2018$college)
qqline(dframe2018$college, col = "blue")
shapiro.test(dframe2018$college)    


ggdensity(dframe2019$college, 
          main = "Density plot of college",
          xlab = "college")
ggqqplot(dframe2019$college)
qqnorm(dframe2019$college)
qqline(dframe2019$college, col = "blue")
shapiro.test(dframe2019$college)

ggdensity(dframe2020$college, 
          main = "Density plot of college",
          xlab = "college")
ggqqplot(dframe2020$college)
qqnorm(dframe2020$college)
qqline(dframe2020$college, col = "blue")
shapiro.test(dframe2020$college)

ggdensity(dframe2021$college, 
          main = "Density plot of college",
          xlab = "college")
ggqqplot(dframe2021$college)
qqnorm(dframe2021$college)
qqline(dframe2021$college, col = "blue")
shapiro.test(dframe2021$college)

```

```{r norm_h, results='markup', include=F}

#
#unempl


ggdensity(dframe2016$unempl, 
          main = "Density plot of unempl",
          xlab = "unempl")
ggqqplot(dframe2016$unempl)
qqnorm(dframe2016$unempl)
qqline(dframe2016$unempl, col = "blue")
shapiro.test(dframe2016$unempl)



ggdensity(dframe2017$unempl, 
          main = "Density plot of unempl",
          xlab = "unempl")
ggqqplot(dframe2017$unempl)
qqnorm(dframe2017$unempl)
qqline(dframe2017$unempl, col = "blue")
shapiro.test(dframe2017$unempl)


ggdensity(dframe2018$unempl, 
          main = "Density plot of unempl",
          xlab = "unempl")
ggqqplot(dframe2018$unempl)
qqnorm(dframe2018$unempl)
qqline(dframe2018$unempl, col = "blue")
shapiro.test(dframe2018$unempl)    


ggdensity(dframe2019$unempl, 
          main = "Density plot of unempl",
          xlab = "unempl")
ggqqplot(dframe2019$unempl)
qqnorm(dframe2019$unempl)
qqline(dframe2019$unempl, col = "blue")
shapiro.test(dframe2019$unempl)

ggdensity(dframe2020$unempl, 
          main = "Density plot of unempl",
          xlab = "unempl")
ggqqplot(dframe2020$unempl)
qqnorm(dframe2020$unempl)
qqline(dframe2020$unempl, col = "blue")
shapiro.test(dframe2020$unempl)

ggdensity(dframe2021$unempl, 
          main = "Density plot of unempl",
          xlab = "unempl")
ggqqplot(dframe2021$unempl)
qqnorm(dframe2021$unempl)
qqline(dframe2021$unempl, col = "blue")
shapiro.test(dframe2021$unempl)
```

```{r norm_i, results='markup', include=F}


#
# child poverty


ggdensity(dframe2016$child_poverty, 
          main = "Density plot of child_poverty",
          xlab = "child_poverty")
ggqqplot(dframe2016$child_poverty)
qqnorm(dframe2016$child_poverty)
qqline(dframe2016$child_poverty, col = "blue")
shapiro.test(dframe2016$child_poverty)



ggdensity(dframe2017$child_poverty, 
          main = "Density plot of child_poverty",
          xlab = "child_poverty")
ggqqplot(dframe2017$child_poverty)
qqnorm(dframe2017$child_poverty)
qqline(dframe2017$child_poverty, col = "blue")
shapiro.test(dframe2017$child_poverty)


ggdensity(dframe2018$child_poverty, 
          main = "Density plot of child_poverty",
          xlab = "child_poverty")
ggqqplot(dframe2018$child_poverty)
qqnorm(dframe2018$child_poverty)
qqline(dframe2018$child_poverty, col = "blue")
shapiro.test(dframe2018$child_poverty)    


ggdensity(dframe2019$child_poverty, 
          main = "Density plot of child_poverty",
          xlab = "child_poverty")
ggqqplot(dframe2019$child_poverty)
qqnorm(dframe2019$child_poverty)
qqline(dframe2019$child_poverty, col = "blue")
shapiro.test(dframe2019$child_poverty)

ggdensity(dframe2020$child_poverty, 
          main = "Density plot of child_poverty",
          xlab = "child_poverty")
ggqqplot(dframe2020$child_poverty)
qqnorm(dframe2020$child_poverty)
qqline(dframe2020$child_poverty, col = "blue")
shapiro.test(dframe2020$child_poverty)

ggdensity(dframe2021$child_poverty, 
          main = "Density plot of child_poverty",
          xlab = "child_poverty")
ggqqplot(dframe2021$child_poverty)
qqnorm(dframe2021$child_poverty)
qqline(dframe2021$child_poverty, col = "blue")
shapiro.test(dframe2021$child_poverty)
```

```{r norm_j, results='markup', include=F}

#
# single parent


ggdensity(dframe2016$single_parent, 
          main = "Density plot of single_parent",
          xlab = "single_parent")
ggqqplot(dframe2016$single_parent)
qqnorm(dframe2016$single_parent)
qqline(dframe2016$single_parent, col = "blue")
shapiro.test(dframe2016$single_parent)



ggdensity(dframe2017$single_parent, 
          main = "Density plot of single_parent",
          xlab = "single_parent")
ggqqplot(dframe2017$single_parent)
qqnorm(dframe2017$single_parent)
qqline(dframe2017$single_parent, col = "blue")
shapiro.test(dframe2017$single_parent)


ggdensity(dframe2018$single_parent, 
          main = "Density plot of single_parent",
          xlab = "single_parent")
ggqqplot(dframe2018$single_parent)
qqnorm(dframe2018$single_parent)
qqline(dframe2018$single_parent, col = "blue")
shapiro.test(dframe2018$single_parent)    


ggdensity(dframe2019$single_parent, 
          main = "Density plot of single_parent",
          xlab = "single_parent")
ggqqplot(dframe2019$single_parent)
qqnorm(dframe2019$single_parent)
qqline(dframe2019$single_parent, col = "blue")
shapiro.test(dframe2019$single_parent)

ggdensity(dframe2020$single_parent, 
          main = "Density plot of single_parent",
          xlab = "single_parent")
ggqqplot(dframe2020$single_parent)
qqnorm(dframe2020$single_parent)
qqline(dframe2020$single_parent, col = "blue")
shapiro.test(dframe2020$single_parent)

ggdensity(dframe2021$single_parent, 
          main = "Density plot of single_parent",
          xlab = "single_parent")
ggqqplot(dframe2021$single_parent)
qqnorm(dframe2021$single_parent)
qqline(dframe2021$single_parent, col = "blue")
shapiro.test(dframe2021$single_parent)
```

```{r norm_k, results='markup', include=F}

#
# Severe housing


ggdensity(dframe2016$severe_housing, 
          main = "Density plot of severe_housing",
          xlab = "severe_housing")
ggqqplot(dframe2016$severe_housing)
qqnorm(dframe2016$severe_housing)
qqline(dframe2016$severe_housing, col = "blue")
shapiro.test(dframe2016$severe_housing)



ggdensity(dframe2017$severe_housing, 
          main = "Density plot of severe_housing",
          xlab = "severe_housing")
ggqqplot(dframe2017$severe_housing)
qqnorm(dframe2017$severe_housing)
qqline(dframe2017$severe_housing, col = "blue")
shapiro.test(dframe2017$severe_housing)


ggdensity(dframe2018$severe_housing, 
          main = "Density plot of severe_housing",
          xlab = "severe_housing")
ggqqplot(dframe2018$severe_housing)
qqnorm(dframe2018$severe_housing)
qqline(dframe2018$severe_housing, col = "blue")
shapiro.test(dframe2018$severe_housing)    


ggdensity(dframe2019$severe_housing, 
          main = "Density plot of severe_housing",
          xlab = "severe_housing")
ggqqplot(dframe2019$severe_housing)
qqnorm(dframe2019$severe_housing)
qqline(dframe2019$severe_housing, col = "blue")
shapiro.test(dframe2019$severe_housing)

ggdensity(dframe2020$severe_housing, 
          main = "Density plot of severe_housing",
          xlab = "severe_housing")
ggqqplot(dframe2020$severe_housing)
qqnorm(dframe2020$severe_housing)
qqline(dframe2020$severe_housing, col = "blue")
shapiro.test(dframe2020$severe_housing)

ggdensity(dframe2021$severe_housing, 
          main = "Density plot of severe_housing",
          xlab = "severe_housing")
ggqqplot(dframe2021$severe_housing)
qqnorm(dframe2021$severe_housing)
qqline(dframe2021$severe_housing, col = "blue")
shapiro.test(dframe2021$severe_housing)
```

```{r norm_l, results='markup', include=F}

#
#food index

ggdensity(dframe2016$food_index, 
          main = "Density plot of food_index",
          xlab = "food_index")
ggqqplot(dframe2016$food_index)
qqnorm(dframe2016$food_index)
qqline(dframe2016$food_index, col = "blue")
shapiro.test(dframe2016$food_index)



ggdensity(dframe2017$food_index, 
          main = "Density plot of food_index",
          xlab = "food_index")
ggqqplot(dframe2017$food_index)
qqnorm(dframe2017$food_index)
qqline(dframe2017$food_index, col = "blue")
shapiro.test(dframe2017$food_index)


ggdensity(dframe2018$food_index, 
          main = "Density plot of food_index",
          xlab = "food_index")
ggqqplot(dframe2018$food_index)
qqnorm(dframe2018$food_index)
qqline(dframe2018$food_index, col = "blue")
shapiro.test(dframe2018$food_index)    


ggdensity(dframe2019$food_index, 
          main = "Density plot of food_index",
          xlab = "food_index")
ggqqplot(dframe2019$food_index)
qqnorm(dframe2019$food_index)
qqline(dframe2019$food_index, col = "blue")
shapiro.test(dframe2019$food_index)

ggdensity(dframe2020$food_index, 
          main = "Density plot of food_index",
          xlab = "food_index")
ggqqplot(dframe2020$food_index)
qqnorm(dframe2020$food_index)
qqline(dframe2020$food_index, col = "blue")
shapiro.test(dframe2020$food_index)

ggdensity(dframe2021$food_index, 
          main = "Density plot of food_index",
          xlab = "food_index")
ggqqplot(dframe2021$food_index)
qqnorm(dframe2021$food_index)
qqline(dframe2021$food_index, col = "blue")
shapiro.test(dframe2021$food_index)
```

```{r norm_m, results='markup', include=F}

#
# mh provider


ggdensity(dframe2016$mh_providers, 
          main = "Density plot of mh_providers",
          xlab = "mh_providers")
ggqqplot(dframe2016$mh_providers)
qqnorm(dframe2016$mh_providers)
qqline(dframe2016$mh_providers, col = "blue")
shapiro.test(dframe2016$mh_providers)



ggdensity(dframe2017$mh_providers, 
          main = "Density plot of mh_providers",
          xlab = "mh_providers")
ggqqplot(dframe2017$mh_providers)
qqnorm(dframe2017$mh_providers)
qqline(dframe2017$mh_providers, col = "blue")
shapiro.test(dframe2017$mh_providers)


ggdensity(dframe2018$mh_providers, 
          main = "Density plot of mh_providers",
          xlab = "mh_providers")
ggqqplot(dframe2018$mh_providers)
qqnorm(dframe2018$mh_providers)
qqline(dframe2018$mh_providers, col = "blue")
shapiro.test(dframe2018$mh_providers)    


ggdensity(dframe2019$mh_providers, 
          main = "Density plot of mh_providers",
          xlab = "mh_providers")
ggqqplot(dframe2019$mh_providers)
qqnorm(dframe2019$mh_providers)
qqline(dframe2019$mh_providers, col = "blue")
shapiro.test(dframe2019$mh_providers)

ggdensity(dframe2020$mh_providers, 
          main = "Density plot of mh_providers",
          xlab = "mh_providers")
ggqqplot(dframe2020$mh_providers)
qqnorm(dframe2020$mh_providers)
qqline(dframe2020$mh_providers, col = "blue")
shapiro.test(dframe2020$mh_providers)

ggdensity(dframe2021$mh_providers, 
          main = "Density plot of mh_providers",
          xlab = "mh_providers")
ggqqplot(dframe2021$mh_providers)
qqnorm(dframe2021$mh_providers)
qqline(dframe2021$mh_providers, col = "blue")
shapiro.test(dframe2021$mh_providers)
```

```{r norm_n, results='markup', include=F}

#
#pop_provider_ratio


ggdensity(dframe2016$pop_provider_ratio, 
          main = "Density plot of pop_provider_ratio",
          xlab = "pop_provider_ratio")
ggqqplot(dframe2016$pop_provider_ratio)
qqnorm(dframe2016$pop_provider_ratio)
qqline(dframe2016$pop_provider_ratio, col = "blue")
shapiro.test(dframe2016$pop_provider_ratio)



ggdensity(dframe2017$pop_provider_ratio, 
          main = "Density plot of pop_provider_ratio",
          xlab = "pop_provider_ratio")
ggqqplot(dframe2017$pop_provider_ratio)
qqnorm(dframe2017$pop_provider_ratio)
qqline(dframe2017$pop_provider_ratio, col = "blue")
shapiro.test(dframe2017$pop_provider_ratio)


ggdensity(dframe2018$pop_provider_ratio, 
          main = "Density plot of pop_provider_ratio",
          xlab = "pop_provider_ratio")
ggqqplot(dframe2018$pop_provider_ratio)
qqnorm(dframe2018$pop_provider_ratio)
qqline(dframe2018$pop_provider_ratio, col = "blue")
shapiro.test(dframe2018$pop_provider_ratio)    


ggdensity(dframe2019$pop_provider_ratio, 
          main = "Density plot of pop_provider_ratio",
          xlab = "pop_provider_ratio")
ggqqplot(dframe2019$pop_provider_ratio)
qqnorm(dframe2019$pop_provider_ratio)
qqline(dframe2019$pop_provider_ratio, col = "blue")
shapiro.test(dframe2019$pop_provider_ratio)

ggdensity(dframe2020$pop_provider_ratio, 
          main = "Density plot of pop_provider_ratio",
          xlab = "pop_provider_ratio")
ggqqplot(dframe2020$pop_provider_ratio)
qqnorm(dframe2020$pop_provider_ratio)
qqline(dframe2020$pop_provider_ratio, col = "blue")
shapiro.test(dframe2020$pop_provider_ratio)

ggdensity(dframe2021$pop_provider_ratio, 
          main = "Density plot of pop_provider_ratio",
          xlab = "pop_provider_ratio")
ggqqplot(dframe2021$pop_provider_ratio)
qqnorm(dframe2021$pop_provider_ratio)
qqline(dframe2021$pop_provider_ratio, col = "blue")
shapiro.test(dframe2021$pop_provider_ratio)
```

```{r norm_o, results='markup', eval=F, include=F}

#
# pop


ggdensity(dframe2016$pop, 
          main = "Density plot of pop",
          xlab = "pop")
ggqqplot(dframe2016$pop)
qqnorm(dframe2016$pop)
qqline(dframe2016$pop, col = "blue")
shapiro.test(dframe2016$pop)



ggdensity(dframe2017$pop, 
          main = "Density plot of pop",
          xlab = "pop")
ggqqplot(dframe2017$pop)
qqnorm(dframe2017$pop)
qqline(dframe2017$pop, col = "blue")
shapiro.test(dframe2017$pop)


ggdensity(dframe2018$pop, 
          main = "Density plot of pop",
          xlab = "pop")
ggqqplot(dframe2018$pop)
qqnorm(dframe2018$pop)
qqline(dframe2018$pop, col = "blue")
shapiro.test(dframe2018$pop)    


ggdensity(dframe2019$pop, 
          main = "Density plot of pop",
          xlab = "pop")
ggqqplot(dframe2019$pop)
qqnorm(dframe2019$pop)
qqline(dframe2019$pop, col = "blue")
shapiro.test(dframe2019$pop)

ggdensity(dframe2020$pop, 
          main = "Density plot of pop",
          xlab = "pop")
ggqqplot(dframe2020$pop)
qqnorm(dframe2020$pop)
qqline(dframe2020$pop, col = "blue")
shapiro.test(dframe2020$pop)

ggdensity(dframe2021$pop, 
          main = "Density plot of pop",
          xlab = "pop")
ggqqplot(dframe2021$pop)
qqnorm(dframe2021$pop)
qqline(dframe2021$pop, col = "blue")
shapiro.test(dframe2021$pop)
```

```{r norm_p, results='markup', eval=F, include=FALSE}

#
# pct_below18


ggdensity(dframe2016$pct_below18, 
          main = "Density plot of pct_below18",
          xlab = "pct_below18")
ggqqplot(dframe2016$pct_below18)
qqnorm(dframe2016$pct_below18)
qqline(dframe2016$pct_below18, col = "blue")
shapiro.test(dframe2016$pct_below18)



ggdensity(dframe2017$pct_below18, 
          main = "Density plot of pct_below18",
          xlab = "pct_below18")
ggqqplot(dframe2017$pct_below18)
qqnorm(dframe2017$pct_below18)
qqline(dframe2017$pct_below18, col = "blue")
shapiro.test(dframe2017$pct_below18)


ggdensity(dframe2018$pct_below18, 
          main = "Density plot of pct_below18",
          xlab = "pct_below18")
ggqqplot(dframe2018$pct_below18)
qqnorm(dframe2018$pct_below18)
qqline(dframe2018$pct_below18, col = "blue")
shapiro.test(dframe2018$pct_below18)    


ggdensity(dframe2019$pct_below18, 
          main = "Density plot of pct_below18",
          xlab = "pct_below18")
ggqqplot(dframe2019$pct_below18)
qqnorm(dframe2019$pct_below18)
qqline(dframe2019$pct_below18, col = "blue")
shapiro.test(dframe2019$pct_below18)

ggdensity(dframe2020$pct_below18, 
          main = "Density plot of pct_below18",
          xlab = "pct_below18")
ggqqplot(dframe2020$pct_below18)
qqnorm(dframe2020$pct_below18)
qqline(dframe2020$pct_below18, col = "blue")
shapiro.test(dframe2020$pct_below18)

ggdensity(dframe2021$pct_below18, 
          main = "Density plot of pct_below18",
          xlab = "pct_below18")
ggqqplot(dframe2021$pct_below18)
qqnorm(dframe2021$pct_below18)
qqline(dframe2021$pct_below18, col = "blue")
shapiro.test(dframe2021$pct_below18)
```

```{r norm_q, results='markup', eval=F, include=FALSE}


#
# pct black

ggdensity(dframe2016$pct_black, 
          main = "Density plot of pct_black",
          xlab = "pct_black")
ggqqplot(dframe2016$pct_black)
qqnorm(dframe2016$pct_black)
qqline(dframe2016$pct_black, col = "blue")
shapiro.test(dframe2016$pct_black)



ggdensity(dframe2017$pct_black, 
          main = "Density plot of pct_black",
          xlab = "pct_black")
ggqqplot(dframe2017$pct_black)
qqnorm(dframe2017$pct_black)
qqline(dframe2017$pct_black, col = "blue")
shapiro.test(dframe2017$pct_black)


ggdensity(dframe2018$pct_black, 
          main = "Density plot of pct_black",
          xlab = "pct_black")
ggqqplot(dframe2018$pct_black)
qqnorm(dframe2018$pct_black)
qqline(dframe2018$pct_black, col = "blue")
shapiro.test(dframe2018$pct_black)    


ggdensity(dframe2019$pct_black, 
          main = "Density plot of pct_black",
          xlab = "pct_black")
ggqqplot(dframe2019$pct_black)
qqnorm(dframe2019$pct_black)
qqline(dframe2019$pct_black, col = "blue")
shapiro.test(dframe2019$pct_black)

ggdensity(dframe2020$pct_black, 
          main = "Density plot of pct_black",
          xlab = "pct_black")
ggqqplot(dframe2020$pct_black)
qqnorm(dframe2020$pct_black)
qqline(dframe2020$pct_black, col = "blue")
shapiro.test(dframe2020$pct_black)

ggdensity(dframe2021$pct_black, 
          main = "Density plot of pct_black",
          xlab = "pct_black")
ggqqplot(dframe2021$pct_black)
qqnorm(dframe2021$pct_black)
qqline(dframe2021$pct_black, col = "blue")
shapiro.test(dframe2021$pct_black)
```

```{r norm_r, results='markup', eval=F, include=FALSE}

#
# pct native american


ggdensity(dframe2016$pct_native_am, 
          main = "Density plot of pct_native_am",
          xlab = "pct_native_am")
ggqqplot(dframe2016$pct_native_am)
qqnorm(dframe2016$pct_native_am)
qqline(dframe2016$pct_native_am, col = "blue")
shapiro.test(dframe2016$pct_native_am)



ggdensity(dframe2017$pct_native_am, 
          main = "Density plot of pct_native_am",
          xlab = "pct_native_am")
ggqqplot(dframe2017$pct_native_am)
qqnorm(dframe2017$pct_native_am)
qqline(dframe2017$pct_native_am, col = "blue")
shapiro.test(dframe2017$pct_native_am)


ggdensity(dframe2018$pct_native_am, 
          main = "Density plot of pct_native_am",
          xlab = "pct_native_am")
ggqqplot(dframe2018$pct_native_am)
qqnorm(dframe2018$pct_native_am)
qqline(dframe2018$pct_native_am, col = "blue")
shapiro.test(dframe2018$pct_native_am)    


ggdensity(dframe2019$pct_native_am, 
          main = "Density plot of pct_native_am",
          xlab = "pct_native_am")
ggqqplot(dframe2019$pct_native_am)
qqnorm(dframe2019$pct_native_am)
qqline(dframe2019$pct_native_am, col = "blue")
shapiro.test(dframe2019$pct_native_am)

ggdensity(dframe2020$pct_native_am, 
          main = "Density plot of pct_native_am",
          xlab = "pct_native_am")
ggqqplot(dframe2020$pct_native_am)
qqnorm(dframe2020$pct_native_am)
qqline(dframe2020$pct_native_am, col = "blue")
shapiro.test(dframe2020$pct_native_am)

ggdensity(dframe2021$pct_native_am, 
          main = "Density plot of pct_native_am",
          xlab = "pct_native_am")
ggqqplot(dframe2021$pct_native_am)
qqnorm(dframe2021$pct_native_am)
qqline(dframe2021$pct_native_am, col = "blue")
shapiro.test(dframe2021$pct_native_am)

```

```{r norm_s, results='markup', eval=F, include=FALSE}

#
# pct asian

ggdensity(dframe2016$pct_asian, 
          main = "Density plot of pct_asian",
          xlab = "pct_asian")
ggqqplot(dframe2016$pct_asian)
qqnorm(dframe2016$pct_asian)
qqline(dframe2016$pct_asian, col = "blue")
shapiro.test(dframe2016$pct_asian)



ggdensity(dframe2017$pct_asian, 
          main = "Density plot of pct_asian",
          xlab = "pct_asian")
ggqqplot(dframe2017$pct_asian)
qqnorm(dframe2017$pct_asian)
qqline(dframe2017$pct_asian, col = "blue")
shapiro.test(dframe2017$pct_asian)


ggdensity(dframe2018$pct_asian, 
          main = "Density plot of pct_asian",
          xlab = "pct_asian")
ggqqplot(dframe2018$pct_asian)
qqnorm(dframe2018$pct_asian)
qqline(dframe2018$pct_asian, col = "blue")
shapiro.test(dframe2018$pct_asian)    


ggdensity(dframe2019$pct_asian, 
          main = "Density plot of pct_asian",
          xlab = "pct_asian")
ggqqplot(dframe2019$pct_asian)
qqnorm(dframe2019$pct_asian)
qqline(dframe2019$pct_asian, col = "blue")
shapiro.test(dframe2019$pct_asian)

ggdensity(dframe2020$pct_asian, 
          main = "Density plot of pct_asian",
          xlab = "pct_asian")
ggqqplot(dframe2020$pct_asian)
qqnorm(dframe2020$pct_asian)
qqline(dframe2020$pct_asian, col = "blue")
shapiro.test(dframe2020$pct_asian)

ggdensity(dframe2021$pct_asian, 
          main = "Density plot of pct_asian",
          xlab = "pct_asian")
ggqqplot(dframe2021$pct_asian)
qqnorm(dframe2021$pct_asian)
qqline(dframe2021$pct_asian, col = "blue")
shapiro.test(dframe2021$pct_asian)
```

```{r norm_t, results='markup', eval=F, include=FALSE}

#
# pct hispanic

ggdensity(dframe2016$pct_hispanic, 
          main = "Density plot of pct_hispanic",
          xlab = "pct_hispanic")
ggqqplot(dframe2016$pct_hispanic)
qqnorm(dframe2016$pct_hispanic)
qqline(dframe2016$pct_hispanic, col = "blue")
shapiro.test(dframe2016$pct_hispanic)



ggdensity(dframe2017$pct_hispanic, 
          main = "Density plot of pct_hispanic",
          xlab = "pct_hispanic")
ggqqplot(dframe2017$pct_hispanic)
qqnorm(dframe2017$pct_hispanic)
qqline(dframe2017$pct_hispanic, col = "blue")
shapiro.test(dframe2017$pct_hispanic)


ggdensity(dframe2018$pct_hispanic, 
          main = "Density plot of pct_hispanic",
          xlab = "pct_hispanic")
ggqqplot(dframe2018$pct_hispanic)
qqnorm(dframe2018$pct_hispanic)
qqline(dframe2018$pct_hispanic, col = "blue")
shapiro.test(dframe2018$pct_hispanic)    


ggdensity(dframe2019$pct_hispanic, 
          main = "Density plot of pct_hispanic",
          xlab = "pct_hispanic")
ggqqplot(dframe2019$pct_hispanic)
qqnorm(dframe2019$pct_hispanic)
qqline(dframe2019$pct_hispanic, col = "blue")
shapiro.test(dframe2019$pct_hispanic)

ggdensity(dframe2020$pct_hispanic, 
          main = "Density plot of pct_hispanic",
          xlab = "pct_hispanic")
ggqqplot(dframe2020$pct_hispanic)
qqnorm(dframe2020$pct_hispanic)
qqline(dframe2020$pct_hispanic, col = "blue")
shapiro.test(dframe2020$pct_hispanic)

ggdensity(dframe2021$pct_hispanic, 
          main = "Density plot of pct_hispanic",
          xlab = "pct_hispanic")
ggqqplot(dframe2021$pct_hispanic)
qqnorm(dframe2021$pct_hispanic)
qqline(dframe2021$pct_hispanic, col = "blue")
shapiro.test(dframe2021$pct_hispanic)
```

```{r norm_u, results='markup', eval=F, include=FALSE}

#
#pct white

ggdensity(dframe2016$pct_white, 
          main = "Density plot of pct_white",
          xlab = "pct_white")
ggqqplot(dframe2016$pct_white)
qqnorm(dframe2016$pct_white)
qqline(dframe2016$pct_white, col = "blue")
shapiro.test(dframe2016$pct_white)



ggdensity(dframe2017$pct_white, 
          main = "Density plot of pct_white",
          xlab = "pct_white")
ggqqplot(dframe2017$pct_white)
qqnorm(dframe2017$pct_white)
qqline(dframe2017$pct_white, col = "blue")
shapiro.test(dframe2017$pct_white)


ggdensity(dframe2018$pct_white, 
          main = "Density plot of pct_white",
          xlab = "pct_white")
ggqqplot(dframe2018$pct_white)
qqnorm(dframe2018$pct_white)
qqline(dframe2018$pct_white, col = "blue")
shapiro.test(dframe2018$pct_white)    


ggdensity(dframe2019$pct_white, 
          main = "Density plot of pct_white",
          xlab = "pct_white")
ggqqplot(dframe2019$pct_white)
qqnorm(dframe2019$pct_white)
qqline(dframe2019$pct_white, col = "blue")
shapiro.test(dframe2019$pct_white)

ggdensity(dframe2020$pct_white, 
          main = "Density plot of pct_white",
          xlab = "pct_white")
ggqqplot(dframe2020$pct_white)
qqnorm(dframe2020$pct_white)
qqline(dframe2020$pct_white, col = "blue")
shapiro.test(dframe2020$pct_white)

ggdensity(dframe2021$pct_white, 
          main = "Density plot of pct_white",
          xlab = "pct_white")
ggqqplot(dframe2021$pct_white)
qqnorm(dframe2021$pct_white)
qqline(dframe2021$pct_white, col = "blue")
shapiro.test(dframe2021$pct_white)
```

```{r norm_v, results='markup', eval=F, include=FALSE}

#
# pct female

ggdensity(dframe2016$pct_female, 
          main = "Density plot of pct_female",
          xlab = "pct_female")
ggqqplot(dframe2016$pct_female)
qqnorm(dframe2016$pct_female)
qqline(dframe2016$pct_female, col = "blue")
shapiro.test(dframe2016$pct_female)



ggdensity(dframe2017$pct_female, 
          main = "Density plot of pct_female",
          xlab = "pct_female")
ggqqplot(dframe2017$pct_female)
qqnorm(dframe2017$pct_female)
qqline(dframe2017$pct_female, col = "blue")
shapiro.test(dframe2017$pct_female)


ggdensity(dframe2018$pct_female, 
          main = "Density plot of pct_female",
          xlab = "pct_female")
ggqqplot(dframe2018$pct_female)
qqnorm(dframe2018$pct_female)
qqline(dframe2018$pct_female, col = "blue")
shapiro.test(dframe2018$pct_female)    


ggdensity(dframe2019$pct_female, 
          main = "Density plot of pct_female",
          xlab = "pct_female")
ggqqplot(dframe2019$pct_female)
qqnorm(dframe2019$pct_female)
qqline(dframe2019$pct_female, col = "blue")
shapiro.test(dframe2019$pct_female)

ggdensity(dframe2020$pct_female, 
          main = "Density plot of pct_female",
          xlab = "pct_female")
ggqqplot(dframe2020$pct_female)
qqnorm(dframe2020$pct_female)
qqline(dframe2020$pct_female, col = "blue")
shapiro.test(dframe2020$pct_female)

ggdensity(dframe2021$pct_female, 
          main = "Density plot of pct_female",
          xlab = "pct_female")
ggqqplot(dframe2021$pct_female)
qqnorm(dframe2021$pct_female)
qqline(dframe2021$pct_female, col = "blue")
shapiro.test(dframe2021$pct_female)

```

```{r norm_w, results='markup', eval=F, include=FALSE}

#
# pct rural


ggdensity(dframe2016$pct_rural, 
          main = "Density plot of pct_rural",
          xlab = "pct_rural")
ggqqplot(dframe2016$pct_rural)
qqnorm(dframe2016$pct_rural)
qqline(dframe2016$pct_rural, col = "blue")
shapiro.test(dframe2016$pct_rural)



ggdensity(dframe2017$pct_rural, 
          main = "Density plot of pct_rural",
          xlab = "pct_rural")
ggqqplot(dframe2017$pct_rural)
qqnorm(dframe2017$pct_rural)
qqline(dframe2017$pct_rural, col = "blue")
shapiro.test(dframe2017$pct_rural)


ggdensity(dframe2018$pct_rural, 
          main = "Density plot of pct_rural",
          xlab = "pct_rural")
ggqqplot(dframe2018$pct_rural)
qqnorm(dframe2018$pct_rural)
qqline(dframe2018$pct_rural, col = "blue")
shapiro.test(dframe2018$pct_rural)    


ggdensity(dframe2019$pct_rural, 
          main = "Density plot of pct_rural",
          xlab = "pct_rural")
ggqqplot(dframe2019$pct_rural)
qqnorm(dframe2019$pct_rural)
qqline(dframe2019$pct_rural, col = "blue")
shapiro.test(dframe2019$pct_rural)

ggdensity(dframe2020$pct_rural, 
          main = "Density plot of pct_rural",
          xlab = "pct_rural")
ggqqplot(dframe2020$pct_rural)
qqnorm(dframe2020$pct_rural)
qqline(dframe2020$pct_rural, col = "blue")
shapiro.test(dframe2020$pct_rural)

ggdensity(dframe2021$pct_rural, 
          main = "Density plot of pct_rural",
          xlab = "pct_rural")
ggqqplot(dframe2021$pct_rural)
qqnorm(dframe2021$pct_rural)
qqline(dframe2021$pct_rural, col = "blue")
shapiro.test(dframe2021$pct_rural)

```

```{r norm_shapiro_a, results='markup', eval=F}
#Shapiro test for all the variables as per year 2016

dframest16 = dframe2016[, c('mental_health_days', 'mental_distress_rate', 'inequality',"median_inc", "hs_grad", "college", "unempl", "child_poverty", "single_parent", "severe_housing", "food_index", "mh_providers", "pop_provider_ratio", "pop", "pct_below18", "pct_black", "pct_native_am", "pct_asian", "pct_hispanic", "pct_white", "pct_female", "pct_rural")]

apply(dframest16, 2, shapiro.test)
```

```{r norm_shapiro_b, results='markup', eval=F}
#Shapiro test for all the variables as per year 2017

dframest17 = dframe2017[, c('mental_health_days', 'mental_distress_rate', 'inequality',"median_inc", "hs_grad", "college", "college", "unempl", "child_poverty", "single_parent", "severe_housing", "food_index", "mh_providers", "pop_provider_ratio", "pop", "pct_below18", "pct_black", "pct_native_am", "pct_asian", "pct_hispanic", "pct_white", "pct_female", "pct_rural")]

apply(dframest17, 2, shapiro.test)
```

```{r norm_shapiro_c, results='markup', eval=F}
#Shapiro test for all the variables as per year 2018

dframest18 = dframe2018[, c('mental_health_days', 'mental_distress_rate', 'inequality',"median_inc", "hs_grad", "college", "college", "unempl", "child_poverty", "single_parent", "severe_housing", "food_index", "mh_providers", "pop_provider_ratio", "pop", "pct_below18", "pct_black", "pct_native_am", "pct_asian", "pct_hispanic", "pct_white", "pct_female", "pct_rural")]

apply(dframest18, 2, shapiro.test)
```

```{r norm_shapiro_d, results='markup', eval=F}
#Shapiro test for all the variables as per year 2019

dframest19 = dframe2019[, c('mental_health_days', 'mental_distress_rate', 'inequality',"median_inc", "hs_grad", "college", "college", "unempl", "child_poverty", "single_parent", "severe_housing", "food_index", "mh_providers", "pop_provider_ratio", "pop", "pct_below18", "pct_black", "pct_native_am", "pct_asian", "pct_hispanic", "pct_white", "pct_female", "pct_rural")]

apply(dframest19, 2, shapiro.test)
```

```{r norm_shapiro_e, results='markup', eval=F}
#Shapiro test for all the variables as per year 2020

dframest20 = dframe2020[, c('mental_health_days', 'mental_distress_rate', 'inequality',"median_inc", "hs_grad", "college", "college", "unempl", "child_poverty", "single_parent", "severe_housing", "food_index", "mh_providers", "pop_provider_ratio", "pop", "pct_below18", "pct_black", "pct_native_am", "pct_asian", "pct_hispanic", "pct_white", "pct_female", "pct_rural")]

apply(dframest20, 2, shapiro.test)
```

```{r norm_shapiro_f, results='markup', eval=F}
#Shapiro test for all the variables as per year 2021

dframest21 = dframe2021[, c('mental_health_days', 'mental_distress_rate', 'inequality',"median_inc", "hs_grad", "college", "college", "unempl", "child_poverty", "single_parent", "severe_housing", "food_index", "mh_providers", "pop_provider_ratio", "pop", "pct_below18", "pct_black", "pct_native_am", "pct_asian", "pct_hispanic", "pct_white", "pct_female", "pct_rural")]

apply(dframest21, 2, shapiro.test)
```


## Initial Correlation and Hypothesis Tests
*When applicable.*

**Assigned to:** Alex (with help from Mark)

For example, Chi Square tests, ANOVA analysis, Z-test or Z-interval, T-test or T-interval, etc.

```{r corr, results='markup'}

# slice dataframe to include only numeric variables
ranked_num <- ranked[10:length(ranked)]

# compute correlation matrix of numeric vars
corr_matrix <- cor(ranked_num, use = "na.or.complete") ## specify use to deal with NA values
corr_matrix

# visualize correlation matrix
corr_plot <- corrplot(corr_matrix)
corr_plot


corr_matrix <- cor(ranked[keep_var], use = "na.or.complete") ## specify use to deal with NA values
corr_matrix

# visualize correlation matrix
corr_plot <- corrplot(corr_matrix, method = "number", title="Correlation Matrix for All Numeric Vars.", mar=c(0,0,1,0))
corr_plot



#aov(y ~ x, data=)

#sapply(dframe2, class)

#a<-pairs(dframe2))
#b<-cor(a) ## correlation matrix
#corrplot(dframe2)

```


```{r estimation, results='markup'}

# Estimation: Establish confidence intervals
# t-interval by region for inequality, mental_health_days, mental_distress_rate

# estimate for all regions
ttest99_in <- t.test(x=ranked$inequality, conf.level=0.99)
ttest99_mh_days <- t.test(x=ranked$mental_health_days, conf.level=0.99)
ttest99_mh_rate <- t.test(x=ranked$mental_distress_rate, conf.level=0.99)

ci99_in <- paste0("[", paste0(round(ttest99_in$conf.int, 4), collapse = ", "), "]")

ci99_mh_days <- paste0("[", paste0(round(ttest99_mh_days$conf.int, 4), collapse = ", "), "]")

ci99_mh_rate <- paste0("[", paste0(round(ttest99_mh_rate$conf.int, 4), collapse = ", "), "]")

var_list <- c("inequality", "mental_health_days", "mental_distress_rate")

ci_list <- list(rep(c("All"), times = length(var_list)), var_list, c(ci99_in, ci99_mh_days, ci99_mh_rate))


# estimate by region
region_list <- c("Midwest", "Northeast", "South", "West")

for (r in region_list) {  ## region names
  
  ranked_region <- ranked %>% subset(region==r)
  
  ttest99_in <- t.test(ranked_region$inequality, conf.level=0.99)
  ttest99_mh_days <- t.test(ranked_region$mental_health_days, conf.level=0.99)
  ttest99_mh_rate <- t.test(ranked_region$mental_distress_rate, conf.level=0.99)
  
  ci99_in <- paste0("[", paste0(round(ttest99_in$conf.int, 4), collapse = ", "), "]")
  
  ci99_mh_days <- paste0("[", paste0(round(ttest99_mh_days$conf.int, 4), collapse = ", "), "]")
  
  ci99_mh_rate <- paste0("[", paste0(round(ttest99_mh_rate$conf.int, 4), collapse = ", "), "]")
  
  ci_list[[1]] <- append(ci_list[[1]], rep(c(r), times = length(var_list)))
  ci_list[[2]] <- append(ci_list[[2]], var_list)
  ci_list[[3]] <- append(ci_list[[3]], c(ci99_in, ci99_mh_days, ci99_mh_rate))
  
  #print(ci_list)
}

# print results
for (n in 1:15) {
  
   Tprint(paste(ci_list[[1]][n], ci_list[[2]][n], ci_list[[3]][n], sep=" | "))
  
}

table_a<-cbind(ci_list[[1]][n], ci_list[[2]][n], ci_list[[3]][n], sep=" | ")

table_a %>%
  kbl(caption="t-interval estimates for key variables",
       format= "html", col.names = c("","Region", "Variable","99% Conf. Int."), 
       align="r") %>% 
  kable_classic_2(full_width = F, html_font = "helvetica")

```

Estimate the t-intervals of our key variables at the 99% confidence level.

Given the large size of our data set, 

mean estimates


The t-intervals by region are reported for each variable of interest in the following table:

***
Region | Variable | 99% conf.int |
-------|----------|--------------|
`r ci_list[[1]][1]` | `r ci_list[[2]][1]` | `r ci_list[[3]][1]` |
`r ci_list[[1]][2]` | `r ci_list[[2]][2]` | `r ci_list[[3]][2]` |
`r ci_list[[1]][3]` | `r ci_list[[2]][3]` | `r ci_list[[3]][3]` |
`r ci_list[[1]][4]` | `r ci_list[[2]][4]` | `r ci_list[[3]][4]` |
`r ci_list[[1]][5]` | `r ci_list[[2]][5]` | `r ci_list[[3]][5]` |
`r ci_list[[1]][6]` | `r ci_list[[2]][6]` | `r ci_list[[3]][6]` |
`r ci_list[[1]][7]` | `r ci_list[[2]][7]` | `r ci_list[[3]][7]` |
`r ci_list[[1]][8]` | `r ci_list[[2]][8]` | `r ci_list[[3]][8]` |
`r ci_list[[1]][9]` | `r ci_list[[2]][9]` | `r ci_list[[3]][9]` |
`r ci_list[[1]][10]` | `r ci_list[[2]][10]` | `r ci_list[[3]][10]` |
`r ci_list[[1]][11]` | `r ci_list[[2]][11]` | `r ci_list[[3]][11]` |
`r ci_list[[1]][12]` | `r ci_list[[2]][12]` | `r ci_list[[3]][12]` |
`r ci_list[[1]][13]` | `r ci_list[[2]][13]` | `r ci_list[[3]][13]` |
`r ci_list[[1]][14]` | `r ci_list[[2]][14]` | `r ci_list[[3]][14]` |
`r ci_list[[1]][15]` | `r ci_list[[2]][15]` | `r ci_list[[3]][15]` |
***

We also want to compare the mean values of `inequality`, `mental_health_days`, and `mental_distress_rate` across regions. Since there are 4 regions, we cannot use a 2-sample t-test. Instead, we conducted ANOVA tests for each variable with data for different regions as the samples. [Insert something about assumptions such as normality.]

```{r anova_inequality, results='markup'}

# anova test for inequality
aov_in <- aov(inequality ~ region, data = ranked)

summary_in <- summary(aov_in)

xkabledply(aov_in, title = "ANOVA results: Income inequality by Region")

tukey_in <- TukeyHSD(aov_in)
tukey_in

```

The ANOVA test for income inequality produced an F-statistic of `r summary_in[[1]][1,4]` with a p-value of `r summary_in[[1]][1,5]`. We reject the null hypothesis because the p-value is below a significance level of 0.05, and accept the alternative hypothesis that the means of the regions are not all the same. We followed up with a post-hoc test to determine which groups are significantly different from the others. The Tukey HSD results indicate that all regions are significantly different from each other!

```{r anova_mh, results='markup'}

# mental health days
aov_mh_days <- aov(mental_health_days ~ region, data = ranked)

summary_mh_days <- summary(aov_mh_days)

xkabledply(aov_mh_days, title = "ANOVA results: Poor Mental Health Days by Region")

tukey_mh_days <- TukeyHSD(aov_mh_days)
tukey_mh_days

# frequent mental distress rate
aov_mh_rate <- aov(mental_distress_rate ~ region, data = ranked)

summary_mh_rate <- summary(aov_mh_rate)

xkabledply(aov_mh_rate, title = "ANOVA results: Frequent Mental Distress by Region")

tukey_mh_rate <- TukeyHSD(aov_mh_rate)
tukey_mh_rate



ggplot(ranked_MW, aes(x=mental_health_days)) + geom_histogram() + ggtitle("MW Poor Mental Health Days")
ggplot(ranked_MW, aes(x=mental_distress_rate)) + geom_histogram() + ggtitle("MW Mental Distress Rate")

ggplot(ranked_MW, aes(x=inequality)) + geom_histogram() + ggtitle("MW Inequality")


ggplot(ranked_WE, aes(x=mental_health_days)) + geom_histogram() + ggtitle("WE Poor Mental Health Days")
ggplot(ranked_WE, aes(x=mental_distress_rate)) + geom_histogram() + ggtitle("WE Mental Distress Rate")
ggplot(ranked_WE, aes(x=inequality)) + geom_histogram() + ggtitle("WE Inequality")



ggplot(ranked_NE, aes(x=mental_health_days)) + geom_histogram() + ggtitle(" NE Poor Mental Health Days")
ggplot(ranked_NE, aes(x=mental_distress_rate)) + geom_histogram() + ggtitle("NE Mental Distress Rate")
ggplot(ranked_NE, aes(x=inequality)) + geom_histogram() + ggtitle("NE Inequality")


ggplot(ranked_SO, aes(x=mental_health_days)) + geom_histogram() + ggtitle("SO Poor Mental Health Days")
ggplot(ranked_SO, aes(x=mental_distress_rate)) + geom_histogram() + ggtitle("SO Mental Distress")
ggplot(ranked_SO, aes(x=inequality)) + geom_histogram() + ggtitle("SO Inequality")

#Checking for equal Variance
var(ranked_MW$mental_health_days, na.rm=TRUE)
var(ranked_MW$mental_distress_rate, na.rm=TRUE)
var(ranked_MW$inequality, na.rm =TRUE)

var(ranked_WE$mental_health_days, na.rm=TRUE)
var(ranked_WE$mental_distress_rate, na.rm=TRUE)
var(ranked_WE$inequality, na.rm=TRUE)

var(ranked_NE$mental_health_days, na.rm=TRUE)
var(ranked_NE$mental_distress_rate, na.rm=TRUE)
var(ranked_NE$inequality, na.rm=TRUE)

var(ranked_SO$mental_health_days, na.rm=TRUE)
var(ranked_SO$mental_distress_rate, na.rm=TRUE)
var(ranked_SO$inequality, na.rm=TRUE)

```

The ANOVA test for poor mental health days produced an F-statistic of `r summary_mh_days[[1]][1,4]` with a p-value of `r summary_mh_days[[1]][1,5]`. Again, we reject the null hypothesis and followed up with a post-hoc Tukey HSD. The Tukey results indicate that all regions have significantly different means for `mental_health_days`.

The ANOVA test for the frequent mental distress rate produced an F-statistic of `r summary_mh_rate[[1]][1,4]` with a p-value of `r summary_mh_rate[[1]][1,5]`. After rejecting the null, the Tukey results suggest that all regions, except the Northeast and the West, have significantly different means for `mental_distress_rate`.

[INSERT something about why we're doing a chi-squared test]

can also conduct test of independence to see whether our dependent and independent var are independent
- round values so it's not a huge matrix
- Test of Independence and Homogeneity - we use this to test if two variables are "independent"
H0: vars are independent. 
H1: They are NOT independent.


```{r chitest, results='markup'}

# subset data
ranked_subset <- ranked %>% subset(select = c(inequality,mental_health_days,mental_distress_rate))
xkabledplyhead(ranked_subset, title = "Subset before Rounding")

# round values to limit the size of the contingency table
# inequality and mh_rate have too many decimals that make it very expensive to calculate 
ranked_subset$inequality <- round(ranked_subset$inequality, 1)
ranked_subset$mental_health_days <- round(ranked_subset$mental_health_days, 1)
ranked_subset$mental_distress_rate <- round(ranked_subset$mental_distress_rate, 2)
xkabledplyhead(ranked_subset, title = "Subset after Rounding")

# chi-squared test 1
contable_days <- table(ranked_subset$inequality, ranked_subset$mental_health_days)
chitest_days = chisq.test(contable_days)
chitest_days

# chi-squared test 
contable_rate <- table(ranked_subset$inequality, ranked_subset$mental_distress_rate)
chitest_rate = chisq.test(contable_rate)
chitest_rate

```

The $\chi^2$ test statistic between `inequality` and `mental_health_days` is `r chitest_days$statistic`, with a p-value of `r chitest_days$p.value` and `r chitest_days$parameter` degrees of freedom.

The $\chi^2$ test statistic between `inequality` and `mental_distress_rate` is `r chitest_rate$statistic`, with a p-value of `r chitest_rate$p.value` and `r chitest_rate$parameter` degrees of freedom.

[INSERT conclusion]

```{r chitest_expected, eval=FALSE, include=FALSE}

# tabulate expected frequencies for each chi-squared test
xkabledply(chitest_days$expected, title = "Expected frequencies: Income inequality vs. Poor mental health days", wide = T)

xkabledply(chitest_rate$expected, title = "Expected frequencies: Income inequality vs. Frequent mental distress rate", wide = T)



table61<-chitest_days$expected

table61 %>%
  kbl(caption="Expected Frequencies: Inequality vs. Frequent Mental Health Days",
       format= "html", 
       align="r") %>% 
  kable_classic_2(full_width = F, html_font = "helvetica")




table62<-chitest_rate$expected

table62 %>%
  kbl(caption="Expected Frequencies: Inequality vs. Frequent Mental Distress Rate",
       format= "html", 
       align="r") %>% 
  kable_classic_2(full_width = F, html_font = "helvetica")






```



```{r}

cor(dframe$inequality, dframe$mental_health_days, method = "spearman")


```

[INSERT overall conclusion]

```{r to_add, include=F, eval=F}

# Hypothesis Testing: Test the process of making decisions about the value of a population parameter

# difference in means
# - rural vs urban (create binary indicator at 50%?)
# - across report years (2017 to 2021)


# Linear Modeling and Regression

# - lm()
# - xkablevif()
# - anova()
# - xkabledply()

```
